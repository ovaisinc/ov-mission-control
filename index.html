<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ov</title>
    <!-- v2.0 - Universal Notes -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

        :root {
            --bg-0: #0a0b10;
            --bg-1: #0f1118;
            --bg-2: #151827;
            --text: #e6e8f0;
            --muted: #9aa0b3;
            --accent: #7c6bff;
            --accent-2: #53d3ff;
            --rose: #f472b6;
            --emerald: #34d399;
        }

        body {
            font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
            background: radial-gradient(1200px 600px at 10% -20%, rgba(124, 107, 255, 0.16), transparent 60%),
                        radial-gradient(900px 600px at 100% 0%, rgba(83, 211, 255, 0.14), transparent 50%),
                        linear-gradient(180deg, var(--bg-0) 0%, var(--bg-1) 45%, var(--bg-2) 100%);
            color: var(--text);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        body::before,
        body::after {
            content: "";
            position: fixed;
            inset: -20%;
            z-index: -1;
            background: radial-gradient(600px 300px at 15% 20%, rgba(124, 107, 255, 0.08), transparent 60%),
                        radial-gradient(700px 400px at 80% 10%, rgba(83, 211, 255, 0.07), transparent 55%);
            pointer-events: none;
        }

        .app-shell { position: relative; }
        .mono { font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, monospace; }
        .gradient-text { background: linear-gradient(135deg, #8b7bff 0%, #53d3ff 60%, #f472b6 120%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .glass {
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)) padding-box,
                        linear-gradient(120deg, rgba(124,107,255,0.45), rgba(83,211,255,0.2)) border-box;
            border: 1px solid transparent;
            backdrop-filter: blur(22px) saturate(1.2);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45), inset 0 1px 0 rgba(255,255,255,0.06);
        }
        .glass-quiet { background: rgba(10, 12, 20, 0.6); border: 1px solid rgba(148,163,184,0.12); backdrop-filter: blur(16px); }

        .client-card { transition: transform 0.25s ease, box-shadow 0.25s ease; cursor: pointer; }
        .client-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .hover-lift { transition: transform 0.25s ease, box-shadow 0.25s ease; }
        .hover-lift:hover { transform: translateY(-3px); box-shadow: 0 14px 26px rgba(0,0,0,0.35); }

        .tab-active {
            border-bottom: 2px solid var(--accent);
            color: var(--accent);
            text-shadow: 0 0 18px rgba(124, 107, 255, 0.6);
        }

        .progress-bar { background: rgba(255,255,255,0.08); border-radius: 999px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 999px; transition: width 0.3s; background: linear-gradient(90deg, var(--accent), var(--accent-2)); }

        .btn {
            position: relative;
            border-radius: 0.9rem;
            border: 1px solid rgba(148,163,184,0.25);
            background: linear-gradient(135deg, rgba(124,107,255,0.18), rgba(83,211,255,0.08));
            color: #e6e8f0;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.08);
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 14px 24px rgba(0,0,0,0.3); border-color: rgba(124,107,255,0.45); }
        .btn-ghost { background: rgba(15, 18, 30, 0.55); border-color: rgba(148,163,184,0.2); color: #cbd5f5; }
        .btn-emerald { background: linear-gradient(135deg, rgba(52,211,153,0.25), rgba(16,185,129,0.08)); border-color: rgba(52,211,153,0.4); }
        .btn-rose { background: linear-gradient(135deg, rgba(244,114,182,0.25), rgba(190,18,60,0.08)); border-color: rgba(244,114,182,0.4); }
        .btn-indigo { background: linear-gradient(135deg, rgba(124,107,255,0.28), rgba(83,211,255,0.1)); border-color: rgba(124,107,255,0.5); }

        .ui-input {
            background: rgba(9, 12, 20, 0.72);
            border: 1px solid rgba(148,163,184,0.25);
            color: #e2e8f0;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
            outline: none;
        }
        .ui-input::placeholder { color: rgba(148,163,184,0.6); }
        .ui-input:focus { border-color: rgba(124,107,255,0.7); box-shadow: 0 0 0 3px rgba(124,107,255,0.2); }
        .ui-select {
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='none' viewBox='0 0 24 24'><path stroke='%239aa0b3' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' d='m7 10 5 5 5-5'/></svg>");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 2.5rem;
        }

        .ui-checkbox {
            appearance: none;
            width: 1.15rem;
            height: 1.15rem;
            border-radius: 0.35rem;
            border: 1px solid rgba(148,163,184,0.4);
            background: rgba(9, 12, 20, 0.7);
            display: inline-grid;
            place-content: center;
            transition: border 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
        }
        .ui-checkbox::after {
            content: "";
            width: 0.55rem;
            height: 0.55rem;
            border-radius: 0.2rem;
            transform: scale(0);
            transition: transform 0.12s ease-in-out;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
        }
        .ui-checkbox:checked::after { transform: scale(1); }
        .ui-checkbox:focus-visible { box-shadow: 0 0 0 3px rgba(124,107,255,0.25); }

        .badge {
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.25);
            background: rgba(12, 15, 28, 0.7);
        }

        .pulse { animation: pulseGlow 2.6s ease-in-out infinite; }

        @keyframes fadeUp {
            0% { opacity: 0; transform: translateY(8px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 0 rgba(124,107,255,0); }
            50% { box-shadow: 0 0 18px rgba(124,107,255,0.35); }
        }
        .stagger > * { animation: fadeUp 0.5s ease both; }
        .stagger > *:nth-child(1) { animation-delay: 40ms; }
        .stagger > *:nth-child(2) { animation-delay: 80ms; }
        .stagger > *:nth-child(3) { animation-delay: 120ms; }
        .stagger > *:nth-child(4) { animation-delay: 160ms; }
        .stagger > *:nth-child(5) { animation-delay: 200ms; }
        .stagger > *:nth-child(6) { animation-delay: 240ms; }
        .stagger > *:nth-child(7) { animation-delay: 280ms; }
        .stagger > *:nth-child(8) { animation-delay: 320ms; }

        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: rgba(12, 15, 28, 0.6); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, rgba(124,107,255,0.7), rgba(83,211,255,0.4)); border-radius: 999px; }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, rgba(124,107,255,0.9), rgba(83,211,255,0.6)); }

        .last-contact-green { color: #10b981; }
        .last-contact-yellow { color: #f59e0b; }
        .last-contact-red { color: #ef4444; }

        .workforce-node {
            position: relative;
            border: 1px solid rgba(148,163,184,0.22);
            background: linear-gradient(140deg, rgba(17, 24, 39, 0.65), rgba(30, 41, 59, 0.35));
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
        }
        .workforce-node::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: -18px;
            width: 1px;
            height: 18px;
            background: linear-gradient(180deg, rgba(124,107,255,0.65), rgba(83,211,255,0.2));
            transform: translateX(-50%);
        }
        .workforce-node-end::after { display: none; }
        .status-dot {
            width: 0.45rem;
            height: 0.45rem;
            border-radius: 999px;
            display: inline-block;
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // ALL CLIENTS & ROLES
        const clientsData = [
            { 
                id: "face", name: "FACE Amusement", revenue: 3700, color: "#6366f1", isLegacy: true,
                brand: "Ov Theory (Legacy)", lastContact: "2 days ago", contactStatus: "green", taskCategory: "FACE",
                progress: 65, tasksTotal: 12, tasksDone: 8,
                meetingNotes: "Tom needs agent workflow. 11 agents planned across 3 phases.",
                research: "Review Tracking MCP waiting on Google Business info",
                docs: ["AI Agent Implementation Blueprint", "MCP Server Development Guide"]
            },
            { 
                id: "adtime", name: "Adtime Marketing", revenue: 1600, color: "#f59e0b",
                brand: "", lastContact: "1 week ago", contactStatus: "yellow", taskCategory: "Adtime",
                progress: 40, tasksTotal: 8, tasksDone: 3,
                meetingNotes: "$550K check deposit scheduled. Invoice matching software in progress.",
                research: "Billboard software integration, labor law compliance",
                docs: ["Invoice Matching Research"]
            },
            { 
                id: "aft", name: "Almost Free Teeth", revenue: 3100, color: "#06b6d4",
                brand: "", lastContact: "3 days ago", contactStatus: "green", taskCategory: "AFT",
                progress: 75, tasksTotal: 6, tasksDone: 5,
                meetingNotes: "HIPAA compliance critical. Dental software project.",
                research: "HIPAA requirements for AI handling patient data",
                docs: ["HIPAA Compliance Checklist"]
            },
            { 
                id: "chohan", name: "Chohan", revenue: 0, color: "#ec4899", isInternal: true,
                brand: "AI Audits & Agents", lastContact: "Today", contactStatus: "green", taskCategory: "Chohan",
                progress: 30, tasksTotal: 15, tasksDone: 5,
                meetingNotes: "New company - AI audits, agent development. Building brand.",
                research: "Service offerings, pricing, target market",
                docs: ["AI Transformation Audit Template", "AI Audit Service Offerings"]
            },
            { 
                id: "abbvie", name: "AbbVie", revenue: 6700, color: "#10b981", isEmployment: true,
                brand: "Employment", lastContact: "Yesterday", contactStatus: "green", taskCategory: "AbbVie",
                progress: 50, tasksTotal: 10, tasksDone: 5,
                meetingNotes: "Ross submissions ongoing. Day job.",
                research: "",
                docs: []
            },
            { 
                id: "jamaat", name: "Chicago Jamaat", revenue: 0, color: "#8b5cf6", isCommunity: true,
                brand: "Motamid Role", lastContact: "Today", contactStatus: "green", taskCategory: "Jamaat",
                progress: 20, tasksTotal: 5, tasksDone: 1,
                meetingNotes: "Motamid report due TONIGHT. Follow up with Jazib & Fahad.",
                research: "",
                docs: []
            },
            { 
                id: "five-star-parks", name: "Five Star Parks", revenue: 0, color: "#f472b6", isProspect: true,
                brand: "FEC Prospect", lastContact: "Not contacted", contactStatus: "gray", taskCategory: "Chohan",
                progress: 5, tasksTotal: 3, tasksDone: 0,
                meetingNotes: "Chohan pipeline - amusement park operator. Potential AI audit client.",
                research: "Multi-location amusement parks. Booking automation opportunity.",
                docs: []
            },
            { 
                id: "cineplex", name: "Cineplex", revenue: 0, color: "#f472b6", isProspect: true,
                brand: "FEC Prospect", lastContact: "Not contacted", contactStatus: "gray", taskCategory: "Chohan",
                progress: 5, tasksTotal: 3, tasksDone: 0,
                meetingNotes: "Chohan pipeline - movie theater chain. Potential AI audit client.",
                research: "Canada's largest cinema chain (158 theatres, 1,631 screens). Publicly traded (TSX:CGX). Multi-brand: Cineplex Odeon, Galaxy, Famous Players, SilverCity, Scotiabank Theatre. Services: Movie exhibition, Scene+ loyalty (50%), Cineplex Digital Media (digital signage), The Rec Room, Playdium (arcades). 13,000+ employees. AI Opportunities: (1) Scene+ loyalty optimization - personalized offers, churn prediction. (2) Dynamic pricing engine - demand-based ticket/concession pricing. (3) Digital signage content automation - AI-generated promos per location. (4) Event cinema booking automation - private screenings, corporate events. (5) Staff scheduling optimization across 158 locations. (6) Predictive maintenance for projection equipment. (7) Customer sentiment monitoring across social/review platforms.",
                docs: []
            },
            { 
                id: "metropolis", name: "Metropolis Resort", revenue: 0, color: "#f472b6", isProspect: true,
                brand: "FEC Prospect", lastContact: "Not contacted", contactStatus: "gray", taskCategory: "Chohan",
                progress: 5, tasksTotal: 3, tasksDone: 0,
                meetingNotes: "Chohan pipeline - resort/entertainment complex. AI transformation audit candidate.",
                research: "Resort + entertainment venue hybrid. Multiple revenue streams.",
                docs: []
            },
            { 
                id: "kids-quest", name: "Kids Quest", revenue: 0, color: "#f472b6", isProspect: true,
                brand: "FEC Prospect", lastContact: "Not contacted", contactStatus: "gray", taskCategory: "Chohan",
                progress: 5, tasksTotal: 3, tasksDone: 0,
                meetingNotes: "Chohan pipeline - children's entertainment center chain. Perfect for booking automation.",
                research: "Birthday party booking focus. High no-show potential. Automation high ROI.",
                docs: []
            },
            { 
                id: "carlisle", name: "Carlisle Sports Emporium", revenue: 0, color: "#f472b6", isProspect: true,
                brand: "FEC Prospect", lastContact: "Not contacted", contactStatus: "gray", taskCategory: "Chohan",
                progress: 5, tasksTotal: 3, tasksDone: 0,
                meetingNotes: "Chohan pipeline - sports entertainment complex. AI audit opportunity.",
                research: "Sports + entertainment venue. Event booking, league management potential.",
                docs: []
            },
        ];
        
        // ALL TASKS
        const allTasks = [
            { id: 1, title: "Submit Motamid report", category: "Jamaat", priority: "high", due: "Tonight", done: false },
            { id: 2, title: "Follow up with Jazib & Fahad", category: "Jamaat", priority: "high", due: "Tonight", done: false },
            { id: 3, title: "Deposit $550K check", category: "Adtime", priority: "high", due: "Today", done: false },
            { id: 4, title: "Send Tom agent workflow", category: "FACE", priority: "high", due: "Today", done: false },
            { id: 5, title: "Ross submission - batch 1", category: "AbbVie", priority: "medium", due: "This week", done: true },
            { id: 6, title: "Ross submission - batch 2", category: "AbbVie", priority: "medium", due: "This week", done: false },
            { id: 7, title: "Review FACE phase 1 agents", category: "FACE", priority: "medium", due: "Tomorrow", done: false },
            { id: 8, title: "HIPAA compliance review", category: "AFT", priority: "high", due: "This week", done: false },
            { id: 9, title: "Chohan service offerings doc", category: "Chohan", priority: "medium", due: "This week", done: false },
            { id: 10, title: "Call Colin â€” dentist software connect", category: "Chohan", priority: "high", due: "Tomorrow", done: false },
            { id: 11, title: "Follow up with Colin â€” government contracts", category: "Chohan", priority: "high", due: "Tomorrow", done: false },
            { id: 12, title: "Update invoicing system", category: "Adtime", priority: "low", due: "Next week", done: false },
        ];
        
        // EMERGENCY PREP (SHTF) LIST
        const emergencyItems = [
            { id: 1, item: "3-day water supply (1 gal/person/day)", category: "Supplies", priority: "critical", done: true },
            { id: 2, item: "Water purification tablets", category: "Supplies", priority: "high", done: true },
            { id: 3, item: "30-day non-perishable food", category: "Supplies", priority: "critical", done: false },
            { id: 4, item: "Manual can opener", category: "Supplies", priority: "high", done: true },
            { id: 5, item: "First aid kit + medications", category: "Supplies", priority: "critical", done: true },
            { id: 6, item: "Prescription meds (30-day)", category: "Supplies", priority: "critical", done: false },
            { id: 7, item: "Flashlights + batteries", category: "Supplies", priority: "critical", done: true },
            { id: 8, item: "Battery-powered radio", category: "Supplies", priority: "high", done: true },
            { id: 9, item: "Power bank (fully charged)", category: "Supplies", priority: "high", done: true },
            { id: 10, item: "Solar/crank charger", category: "Supplies", priority: "medium", done: false },
            { id: 11, item: "Cash ($500-1000 small bills)", category: "Financial", priority: "critical", done: false },
            { id: 12, item: "Important docs (copies)", category: "Documents", priority: "critical", done: true },
            { id: 13, item: "Emergency contacts list", category: "Network", priority: "critical", done: true },
            { id: 14, item: "Whistle (3 blasts = help)", category: "Skills", priority: "high", done: true },
            { id: 15, item: "Fire extinguisher", category: "Supplies", priority: "critical", done: true },
            { id: 16, item: "Dust masks", category: "Supplies", priority: "medium", done: false },
            { id: 17, item: "Multi-tool / Swiss Army", category: "Supplies", priority: "high", done: true },
            { id: 18, item: "Duct tape", category: "Supplies", priority: "medium", done: true },
            { id: 19, item: "Plastic sheeting", category: "Supplies", priority: "medium", done: false },
            { id: 20, item: "Sleeping bags/blankets", category: "Supplies", priority: "high", done: true },
            { id: 21, item: "Personal hygiene items", category: "Supplies", priority: "medium", done: true },
            { id: 22, item: "Bleach (sanitization)", category: "Supplies", priority: "medium", done: false },
            { id: 23, item: "Family emergency plan", category: "Documents", priority: "critical", done: false },
        ];
        
        // PERSONAL TASKS
        const personalTasks = [
            { id: 1, title: "Email Kris from Village back", category: "Personal", priority: "high", done: false, type: "personal" },
            { id: 2, title: "Order food prep stuff", category: "Personal", priority: "medium", done: false, type: "personal" },
            { id: 3, title: "Schedule dentist appointment", category: "Personal", priority: "high", done: false, type: "personal" },
            { id: 4, title: "Take cholesterol test", category: "Personal", priority: "high", done: false, type: "personal" },
            { id: 5, title: "Pay Schaumburg ticket", category: "Personal", priority: "critical", done: false, type: "personal" },
        ];

        const proposalsProjectsSeed = [
            {
                id: 101,
                clientId: "adtime",
                clientName: "AdTime",
                projectName: "AI Automation Retainer Proposal",
                type: "Retainer",
                status: "Draft",
                value: "$4,000/mo",
                notes: "Monthly automation roadmap for reporting, lead ops, and billing workflows.",
                proposalContent: `Scope:
- Weekly automation planning and deployment support
- CRM and invoice workflow automations
- Monthly optimization report

Timeline:
- Month-to-month retainer with 30-day notice

Deliverables:
- Priority automation queue
- KPI dashboard updates
- SOP updates for internal team handoff`,
            },
            {
                id: 102,
                clientId: "adtime",
                clientName: "AdTime",
                projectName: "List Home Flat Fee Website Project",
                type: "Website",
                status: "Sent",
                value: "$6,500",
                notes: "Marketing site focused on seller conversion and local SEO.",
                proposalContent: `Scope:
- 6 core marketing pages
- Lead form integrations and analytics
- SEO foundation and launch QA

Timeline:
- 4-6 weeks including revisions

Deliverables:
- Responsive website build
- CMS handoff with editing guide
- Launch checklist and performance baseline`,
            },
            {
                id: 103,
                clientId: "adtime",
                clientName: "AdTime",
                projectName: "Gym Website Project",
                type: "Website",
                status: "In Progress",
                value: "$8,200",
                notes: "Membership-focused website with class schedule and inquiry funnel.",
                proposalContent: `Scope:
- Homepage, class pages, trainer bios, and contact flow
- Lead capture and CRM sync
- Mobile-first performance optimization

Timeline:
- 5 weeks with staged milestone approvals

Deliverables:
- Full design + development implementation
- Basic content migration
- Launch support and analytics setup`,
            },
        ];
        
        const STORAGE_KEYS = {
            tasks: "ovmc_tasks",
            personal: "ovmc_personal",
            emergency: "ovmc_emergency",
            completed: "ovmc_completed",
            notes: "ovmc_notes",
            noteDraft: "ovmc_notes_draft",
            noteTag: "ovmc_notes_tag",
            noteLinkedTo: "ovmc_notes_linked_to",
            personalGoals: "ovmc_personal_goals",
            projects: "ovmc_projects",
            briefs: "ovmc_briefs",
            briefsRead: "ovmc_briefs_read",
        };
        
        const loadFromStorage = (key, fallback) => {
            try {
                const raw = localStorage.getItem(key);
                if (!raw) return fallback;
                const parsed = JSON.parse(raw);
                if (Array.isArray(fallback)) {
                    return Array.isArray(parsed) ? parsed : fallback;
                }
                if (fallback && typeof fallback === "object") {
                    return parsed && typeof parsed === "object" ? parsed : fallback;
                }
                return parsed ?? fallback;
            } catch (err) {
                return fallback;
            }
        };
        
        const buildInitialTaskState = () => {
            // DEFENSIVE: Check if actual data exists in localStorage first
            const existingTasksRaw = localStorage.getItem(STORAGE_KEYS.tasks);
            const existingPersonalRaw = localStorage.getItem(STORAGE_KEYS.personal);
            const existingCompletedRaw = localStorage.getItem(STORAGE_KEYS.completed);
            
            const hasExistingTasks = Boolean(existingTasksRaw && existingTasksRaw !== "[]");
            const hasExistingPersonal = Boolean(existingPersonalRaw && existingPersonalRaw !== "[]");
            const hasExistingCompleted = Boolean(existingCompletedRaw && existingCompletedRaw !== "[]");
            
            // Only load defaults if NO data exists yet (first visit)
            const shouldLoadDefaultTasks = !hasExistingTasks && !hasExistingCompleted;
            const shouldLoadDefaultPersonal = !hasExistingPersonal && !hasExistingCompleted;

            const rawTasks = loadFromStorage(STORAGE_KEYS.tasks, shouldLoadDefaultTasks ? allTasks : []);
            const rawPersonal = loadFromStorage(STORAGE_KEYS.personal, shouldLoadDefaultPersonal ? personalTasks : []);

            // MIGRATE: Add any new default tasks that aren't in localStorage yet
            const existingIds = new Set(rawTasks.map(t => t.id));
            const newTasks = allTasks.filter(t => !existingIds.has(t.id));
            if (newTasks.length > 0) {
                rawTasks.push(...newTasks);
                // Save back to localStorage
                try {
                    localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(rawTasks));
                } catch (err) {
                    // Ignore write failures
                }
            }

            // Set flags for future reference
            try {
                localStorage.setItem("ovmc_initialized", "true");
                localStorage.setItem("ovmc_personal_initialized", "true");
            } catch (err) {
                // Ignore localStorage write failures and continue with in-memory state.
            }

            const storedCompleted = loadFromStorage(STORAGE_KEYS.completed, []);
            const completed = Array.isArray(storedCompleted) ? [...storedCompleted] : [];

            const splitActive = (items, type) => {
                const active = [];
                items.forEach(item => {
                    if (item.done) {
                        completed.push({ ...item, type });
                    } else {
                        active.push(item);
                    }
                });
                return active;
            };

            return {
                activeTasks: splitActive(rawTasks, "business"),
                activePersonal: splitActive(rawPersonal, "personal"),
                completed,
            };
        };

        const migrateLegacyNotes = () => {
            const storedNotes = loadFromStorage(STORAGE_KEYS.notes, null);
            if (Array.isArray(storedNotes)) return storedNotes;

            const legacyPersonal = loadFromStorage("ovmc_personal_notes", []);
            const legacyClientNotes = loadFromStorage("ovmc_client_notes", null);
            const migrated = [];

            if (Array.isArray(legacyPersonal)) {
                legacyPersonal.forEach(note => {
                    migrated.push({
                        id: note.id || Date.now() + Math.random(),
                        timestamp: note.timestamp || new Date().toISOString(),
                        content: note.content || "",
                        tag: note.tag || "",
                        linkedTo: "personal",
                    });
                });
            }

            if (legacyClientNotes && typeof legacyClientNotes === "object") {
                Object.entries(legacyClientNotes).forEach(([clientId, content]) => {
                    if ((content || "").trim()) {
                        migrated.push({
                            id: Date.now() + Math.random(),
                            timestamp: new Date().toISOString(),
                            content: String(content),
                            tag: "",
                            linkedTo: clientId,
                        });
                    }
                });
            }

            return migrated;
        };
        
        function App() {
            const [activeTab, setActiveTab] = useState("dashboard");
            const [selectedClient, setSelectedClient] = useState(null);
            const [detailTab, setDetailTab] = useState("overview");
            const [quickTaskText, setQuickTaskText] = useState("");
            const [personalTaskText, setPersonalTaskText] = useState("");
            const [personalTaskDue, setPersonalTaskDue] = useState("none");
            const initialTaskState = useMemo(() => buildInitialTaskState(), []);
            const [tasks, setTasks] = useState(initialTaskState.activeTasks);
            const [personal, setPersonal] = useState(initialTaskState.activePersonal);
            const [completedTasks, setCompletedTasks] = useState(initialTaskState.completed);
            const [emergency, setEmergency] = useState(() => loadFromStorage(STORAGE_KEYS.emergency, emergencyItems));
            const [searchTerm, setSearchTerm] = useState("");
            const [notes, setNotes] = useState(() => migrateLegacyNotes());
            const [noteDraft, setNoteDraft] = useState(() => loadFromStorage(STORAGE_KEYS.noteDraft, ""));
            const [noteTag, setNoteTag] = useState(() => loadFromStorage(STORAGE_KEYS.noteTag, ""));
            const [noteLinkedTo, setNoteLinkedTo] = useState(() => loadFromStorage(STORAGE_KEYS.noteLinkedTo, null));
            const [personalGoals, setPersonalGoals] = useState(() => loadFromStorage(STORAGE_KEYS.personalGoals, []));
            const [goalText, setGoalText] = useState("");
            const [taskFilter, setTaskFilter] = useState("all");
            const [clientFilter, setClientFilter] = useState(clientsData[0]?.taskCategory || "");
            const [expandedPrepCategory, setExpandedPrepCategory] = useState(null);
            const [showCompleted, setShowCompleted] = useState(false);
            const [noteFilter, setNoteFilter] = useState("all");
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [editingTaskType, setEditingTaskType] = useState(null);
            const [editForm, setEditForm] = useState({ title: "", category: "", priority: "medium", due: "" });
            const [editError, setEditError] = useState("");
            const [projects, setProjects] = useState(() => {
                // DEFENSIVE: Only load seed projects if no projects exist yet
                const existingProjects = localStorage.getItem(STORAGE_KEYS.projects);
                const shouldLoadSeed = !existingProjects || existingProjects === "[]";
                return loadFromStorage(STORAGE_KEYS.projects, shouldLoadSeed ? proposalsProjectsSeed : []);
            });
            const [activeProjectModal, setActiveProjectModal] = useState(null);
            const [newProjectForm, setNewProjectForm] = useState({
                clientId: "adtime",
                clientName: "AdTime",
                projectName: "",
                type: "Website",
                status: "Draft",
                value: "",
                notes: "",
                proposalContent: "",
            });

            // BRIEFS STATE
            const seedBriefs = [
                {
                    id: 'ai-weekly-2026-02-08',
                    date: '2026-02-08',
                    type: 'AI Weekly',
                    sentiment: { score: 82, label: 'Breakneck' },
                    tickers: ['AI', 'AGI', 'Claude', 'Codex'],
                    title: 'AI Weekly Brief: Opus 4.6 + GPT-5.3-Codex Drop',
                    summary: 'Claude Opus 4.6 and GPT-5.3-Codex both released. First self-improving model. Super Bowl AI ad blitz. 400+ malicious ClawHub skills found.',
                    content: 'Sample AI brief content',
                    pdfUrl: 'https://ovaisinc.github.io/ov-mission-control/briefs/2026-02-08-ai-weekly.pdf'
                },
                {
                    id: 'daily-2026-02-09',
                    date: '2026-02-09',
                    type: 'Daily',
                    sentiment: { score: 72, label: 'Greed' },
                    tickers: ['BTC', 'ETH', 'NVDA', 'GLD'],
                    title: 'Daily Brief: Pre-Market â€” Tech Earnings Week',
                    summary: 'S&P +0.4%. BTC @ $96,200 holding support. NVDA earnings Wed with 8% implied move. Gold near ATH at $2,865.',
                    content: 'Sample daily brief content',
                    pdfUrl: 'https://ovaisinc.github.io/ov-mission-control/briefs/2026-02-09-daily-sample.pdf'
                }
            ];
            const [briefs, setBriefs] = useState(() => loadFromStorage(STORAGE_KEYS.briefs, seedBriefs));
            const [readBriefIds, setReadBriefIds] = useState(() => loadFromStorage(STORAGE_KEYS.briefsRead, []));
            const [activeBriefModal, setActiveBriefModal] = useState(null);
            const [briefFilter, setBriefFilter] = useState("all");
            
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(tasks));
            }, [tasks]);
            
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.personal, JSON.stringify(personal));
            }, [personal]);
            
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.emergency, JSON.stringify(emergency));
            }, [emergency]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.completed, JSON.stringify(completedTasks));
            }, [completedTasks]);
            
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.notes, JSON.stringify(notes));
            }, [notes]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.noteDraft, noteDraft);
            }, [noteDraft]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.noteTag, noteTag);
            }, [noteTag]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.noteLinkedTo, JSON.stringify(noteLinkedTo));
            }, [noteLinkedTo]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.personalGoals, JSON.stringify(personalGoals));
            }, [personalGoals]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.projects, JSON.stringify(projects));
            }, [projects]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.briefs, JSON.stringify(briefs));
            }, [briefs]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.briefsRead, JSON.stringify(readBriefIds));
            }, [readBriefIds]);
            
            const toggleTask = (id, list, setList) => {
                setList(list.map(t => t.id === id ? { ...t, done: !t.done } : t));
            };

            const completeTask = (task, type) => {
                if (type === "business") {
                    setTasks(prev => prev.filter(t => t.id !== task.id));
                } else {
                    setPersonal(prev => prev.filter(t => t.id !== task.id));
                }
                setCompletedTasks(prev => [{ ...task, done: true, type }, ...prev]);
            };

            const restoreTask = (task) => {
                setCompletedTasks(prev => prev.filter(t => !(t.id === task.id && t.type === task.type)));
                if (task.type === "business") {
                    const { type, ...rest } = task;
                    setTasks(prev => [{ ...rest, done: false }, ...prev]);
                } else {
                    setPersonal(prev => [{ ...task, done: false, type: "personal" }, ...prev]);
                }
            };
            
            const mergedTasks = [
                ...tasks.map(t => ({ ...t, type: "business" })),
                ...personal.map(t => ({ ...t, type: "personal" })),
            ];
            
            const matchesSearch = (task) => {
                const term = searchTerm.trim().toLowerCase();
                if (!term) return true;
                const fields = [task.title, task.category, task.type];
                return fields.some(field => (field || "").toLowerCase().includes(term));
            };
            
            const matchesFilter = (task) => {
                if (taskFilter === "business") return task.type === "business";
                if (taskFilter === "personal") return task.type === "personal";
                if (taskFilter === "client") return task.type === "business" && task.category === clientFilter;
                return true;
            };
            
            const filteredTasks = mergedTasks.filter(task => matchesSearch(task) && matchesFilter(task));
            const filteredCompleted = completedTasks
                .filter(task => matchesSearch(task) && matchesFilter(task))
                .map(task => ({ ...task, type: task.type || "business" }));
            
            const totalRev = clientsData.reduce((sum, c) => sum + c.revenue, 0);
            const totalProfit = totalRev * 0.75; // ~75% profit margin
            const pendingTasks = tasks.filter(t => !t.done).length + personal.filter(t => !t.done).length;
            const emergencyDone = emergency.filter(e => e.done).length;
            const emergencyProgress = (emergencyDone / emergency.length) * 100;
            const emergencyCategories = [
                { id: "Financial", label: "Financial", bar: "bg-emerald-500", accent: "text-emerald-300" },
                { id: "Supplies", label: "Supplies", bar: "bg-cyan-500", accent: "text-cyan-300" },
                { id: "Documents", label: "Documents", bar: "bg-amber-500", accent: "text-amber-300" },
                { id: "Skills", label: "Skills", bar: "bg-indigo-500", accent: "text-indigo-300" },
                { id: "Network", label: "Network", bar: "bg-pink-500", accent: "text-pink-300" },
            ];
            const emergencyCategoryData = emergencyCategories.map(category => {
                const items = emergency.filter(item => item.category === category.id);
                const done = items.filter(item => item.done).length;
                const total = items.length;
                const progress = total > 0 ? Math.round((done / total) * 100) : 0;
                return { ...category, items, done, total, progress };
            });
            
            const getContactClass = (status) => {
                if (status === "green") return "last-contact-green";
                if (status === "yellow") return "last-contact-yellow";
                return "last-contact-red";
            };
            
            const getClientColor = (category) => {
                const client = clientsData.find(c => c.taskCategory.toLowerCase() === (category || "").toLowerCase());
                return client?.color || "#6b7280";
            };

            const openClient = (client) => {
                setSelectedClient(client);
                setDetailTab("overview");
            };

            const addQuickTask = () => {
                if (!selectedClient) return;
                const title = quickTaskText.trim();
                if (!title) return;
                const newTask = {
                    id: Date.now(),
                    title,
                    category: selectedClient.taskCategory,
                    priority: "medium",
                    due: "This week",
                    done: false,
                };
                setTasks(prev => [newTask, ...prev]);
                setQuickTaskText("");
            };

            const addPersonalTask = () => {
                const title = personalTaskText.trim();
                if (!title) return;
                const dueLabel = personalTaskDue === "today" ? "Today" : personalTaskDue === "tonight" ? "Tonight" : "";
                const newTask = {
                    id: Date.now(),
                    title,
                    category: "Personal",
                    priority: "medium",
                    due: dueLabel,
                    done: false,
                    type: "personal",
                };
                setPersonal(prev => [newTask, ...prev]);
                setPersonalTaskText("");
                setPersonalTaskDue("none");
            };

            const addNote = (linkedToOverride) => {
                const content = noteDraft.trim();
                if (!content) return;
                const resolvedLinkedTo = linkedToOverride !== undefined ? linkedToOverride : noteLinkedTo;
                const newNote = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    content,
                    tag: noteTag.trim() || "",
                    linkedTo: resolvedLinkedTo ?? null,
                };
                setNotes(prev => [newNote, ...prev]);
                setNoteDraft("");
                setNoteTag("");
            };

            const updateNote = (id, updates) => {
                setNotes(prev => prev.map(note => note.id === id ? { ...note, ...updates } : note));
            };

            const addPersonalGoal = () => {
                const content = goalText.trim();
                if (!content) return;
                const newGoal = {
                    id: Date.now(),
                    text: content,
                    createdAt: new Date().toISOString(),
                };
                setPersonalGoals(prev => [newGoal, ...prev]);
                setGoalText("");
            };

            const projectStatusStyles = {
                Draft: "text-gray-300 border-gray-600 bg-gray-500/10",
                Sent: "text-cyan-200 border-cyan-500/40 bg-cyan-500/10",
                "In Progress": "text-indigo-200 border-indigo-500/40 bg-indigo-500/10",
                Approved: "text-emerald-200 border-emerald-500/40 bg-emerald-500/10",
                Completed: "text-purple-200 border-purple-500/40 bg-purple-500/10",
            };

            const projectStatusOptions = ["Draft", "Sent", "In Progress", "Approved", "Completed"];

            const updateProjectField = (id, field, value) => {
                setProjects(prev => prev.map(project => project.id === id ? { ...project, [field]: value } : project));
            };

            const addProject = () => {
                const name = newProjectForm.projectName.trim();
                if (!name) return;
                const value = newProjectForm.value.trim();
                const notes = newProjectForm.notes.trim();
                const proposalContent = newProjectForm.proposalContent.trim();
                const nextProject = {
                    id: Date.now(),
                    clientId: newProjectForm.clientId,
                    clientName: newProjectForm.clientName,
                    projectName: name,
                    type: newProjectForm.type,
                    status: newProjectForm.status,
                    value: value || "$0",
                    notes,
                    proposalContent: proposalContent || "Proposal content not added yet.",
                };
                setProjects(prev => [nextProject, ...prev]);
                setNewProjectForm(prev => ({
                    ...prev,
                    projectName: "",
                    value: "",
                    notes: "",
                    proposalContent: "",
                }));
            };

            const groupedProjects = projects.reduce((acc, project) => {
                if (!acc[project.clientId]) {
                    acc[project.clientId] = {
                        clientId: project.clientId,
                        clientName: project.clientName,
                        projects: [],
                    };
                }
                acc[project.clientId].projects.push(project);
                return acc;
            }, {});

            const projectClientOptions = [
                { id: "adtime", name: "AdTime" },
                ...clientsData
                    .filter(client => client.id !== "adtime")
                    .map(client => ({ id: client.id, name: client.name })),
            ];
            
            const resetData = () => {
                Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
                ["ovmc_personal_notes", "ovmc_client_notes", "ovmc_personal_note_draft", "ovmc_personal_note_tag"].forEach(key => localStorage.removeItem(key));
                const resetCompleted = [];
                const resetActiveTasks = [];
                const resetActivePersonal = [];
                allTasks.forEach(item => {
                    if (item.done) {
                        resetCompleted.push({ ...item, type: "business" });
                    } else {
                        resetActiveTasks.push(item);
                    }
                });
                personalTasks.forEach(item => {
                    if (item.done) {
                        resetCompleted.push({ ...item, type: "personal" });
                    } else {
                        resetActivePersonal.push(item);
                    }
                });
                setTasks(resetActiveTasks);
                setPersonal(resetActivePersonal);
                setEmergency(emergencyItems);
                setCompletedTasks(resetCompleted);
                setNotes([]);
                setNoteDraft("");
                setNoteTag("");
                setNoteLinkedTo(null);
                setPersonalGoals([]);
                setGoalText("");
                setPersonalTaskText("");
                setPersonalTaskDue("none");
                setSearchTerm("");
                setTaskFilter("all");
                setClientFilter(clientsData[0]?.taskCategory || "");
                setExpandedPrepCategory(null);
                setShowCompleted(false);
                setProjects(proposalsProjectsSeed);
                setActiveProjectModal(null);
                setNewProjectForm({
                    clientId: "adtime",
                    clientName: "AdTime",
                    projectName: "",
                    type: "Website",
                    status: "Draft",
                    value: "",
                    notes: "",
                    proposalContent: "",
                });
            };

            const clearCompleted = () => setCompletedTasks([]);

            // BRIEFS HELPERS
            const isBriefRead = (briefId) => readBriefIds.includes(briefId);
            const markBriefAsRead = (briefId) => {
                if (!isBriefRead(briefId)) {
                    setReadBriefIds(prev => [...prev, briefId]);
                }
            };
            const markBriefAsUnread = (briefId) => {
                setReadBriefIds(prev => prev.filter(id => id !== briefId));
            };
            const getTypeIcon = (type) => {
                switch(type) {
                    case "Daily": return "ðŸ“Š";
                    case "Weekend": return "ðŸ“…";
                    case "Crypto": return "ðŸª™";
                    default: return "ðŸ“ˆ";
                }
            };
            const filteredBriefs = briefs.filter(brief => {
                if (briefFilter === "all") return true;
                if (briefFilter === "unread") return !isBriefRead(brief.id);
                return brief.type.toLowerCase() === briefFilter.toLowerCase();
            });
            const unreadCount = briefs.filter(b => !isBriefRead(b.id)).length;
            const thisWeekCount = briefs.filter(b => {
                const briefDate = new Date(b.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return briefDate >= weekAgo;
            }).length;
            const lastUpdated = briefs.length > 0 ? briefs[0].date : "--";

            const startEditTask = (task, typeOverride) => {
                const resolvedType = typeOverride || task.type || "business";
                setEditingTaskId(task.id);
                setEditingTaskType(resolvedType);
                setEditForm({
                    title: task.title || "",
                    category: task.category || "",
                    priority: task.priority || "medium",
                    due: task.due || "",
                });
                setEditError("");
            };

            const cancelEditTask = () => {
                setEditingTaskId(null);
                setEditingTaskType(null);
                setEditForm({ title: "", category: "", priority: "medium", due: "" });
                setEditError("");
            };

            const saveEditTask = () => {
                const trimmedTitle = editForm.title.trim();
                if (!trimmedTitle) {
                    setEditError("Title cannot be empty.");
                    return;
                }
                const updates = {
                    title: trimmedTitle,
                    category: editForm.category,
                    priority: editForm.priority,
                    due: editForm.due,
                };
                if (editingTaskType === "personal") {
                    setPersonal(prev => prev.map(t => t.id === editingTaskId ? { ...t, ...updates } : t));
                } else {
                    setTasks(prev => prev.map(t => t.id === editingTaskId ? { ...t, ...updates } : t));
                }
                cancelEditTask();
            };

            const handleEditKeyDown = (event) => {
                if (event.key === "Enter") {
                    event.preventDefault();
                    saveEditTask();
                }
                if (event.key === "Escape") {
                    event.preventDefault();
                    cancelEditTask();
                }
            };

            const detailSections = [
                { id: "overview", label: "Overview" },
                { id: "tasks", label: "Tasks" },
                { id: "meetings", label: "Meetings" },
                { id: "notes", label: "Notes" },
                { id: "research", label: "Research" },
                { id: "files", label: "Files" },
                { id: "activity", label: "Activity" },
            ];

            const navTabs = [
                { id: "dashboard", label: "dashboard" },
                { id: "clients", label: "clients" },
                { id: "tasks", label: "tasks" },
                { id: "aiworkforce", label: "AI Workforce" },
                { id: "briefs", label: "briefs" },
                { id: "personal", label: "personal" },
                { id: "notes", label: "notes" },
                { id: "emergency", label: "Prep" },
            ];

            const workforceAgents = [
                {
                    name: "OV",
                    role: "Owner",
                    model: "Executive Direction",
                    costTier: "N/A",
                    status: "active",
                    capabilities: ["Mission priorities", "Final approvals", "Escalation authority"],
                    description: "Defines outcomes and constraints for the full workforce.",
                    accent: "from-purple-500/35 to-cyan-400/15",
                },
                {
                    name: "Aiden ðŸŒ€",
                    role: "Chief of Staff",
                    model: "Always-on orchestration layer",
                    costTier: "$",
                    status: "active",
                    capabilities: ["Cross-team orchestration", "Routing decisions", "Context continuity"],
                    description: "Always-on coordinator that sequences work across all departments.",
                    accent: "from-indigo-500/35 to-sky-400/20",
                },
                {
                    name: "Codex 5.3",
                    role: "Lead Engineer",
                    model: "gpt-5.3-codex",
                    costTier: "$",
                    status: "active",
                    capabilities: ["Implementation", "Refactors", "Testing and debugging"],
                    description: "Default execution engine for engineering delivery and iteration.",
                    accent: "from-emerald-500/30 to-cyan-400/15",
                },
                {
                    name: "Opus 4.5",
                    role: "Senior Engineer",
                    model: "Escalation specialist",
                    costTier: "$$$$$",
                    status: "standby",
                    capabilities: ["Complex architecture", "Critical reviews", "High-stakes edge cases"],
                    description: "Invoked only when engineering complexity or risk exceeds base lane.",
                    accent: "from-rose-500/30 to-fuchsia-400/15",
                },
                {
                    name: "Sonnet 4.5",
                    role: "Research Analyst",
                    model: "claude-sonnet-4-5-20250929",
                    costTier: "$$",
                    status: "active",
                    capabilities: ["Rapid synthesis", "Competitive scan", "Structured briefs"],
                    description: "Primary analyst for fast, high-quality multi-source research.",
                    accent: "from-cyan-500/30 to-indigo-400/15",
                },
                {
                    name: "Opus 4.6",
                    role: "Senior Research Analyst",
                    model: "claude-opus-4-6-20260205",
                    costTier: "$$$$$$",
                    status: "standby",
                    capabilities: ["Deep strategy", "Long-horizon analysis", "Complex evidence chains"],
                    description: "Escalation tier for strategic research requiring maximum depth.",
                    accent: "from-amber-500/30 to-rose-400/20",
                },
                {
                    name: "Browser Use",
                    role: "Field Agent",
                    model: "BU Cloud LLM",
                    costTier: "Free",
                    status: "active",
                    capabilities: ["Autonomous browsing", "Web actions", "Live task execution"],
                    description: "Operations agent for real-time browser-side execution.",
                    accent: "from-sky-500/35 to-emerald-400/20",
                },
            ];

            const workforceTools = [
                { name: "Brave Search", detail: "Real-time web search" },
                { name: "Web Fetch", detail: "Read specific URLs" },
                { name: "Browser Use", detail: "Autonomous browsing" },
                { name: "Sessions Spawn", detail: "Launch sub-agents" },
                { name: "Cron Jobs", detail: "Scheduled tasks" },
                { name: "Memory System", detail: "Persistent memory" },
            ];

            const escalationRules = [
                "Lower-tier agent fails 2+ times on same problem",
                "Complex architecture or system design decisions",
                "Security-critical code review required",
                "Deep strategic research with multi-source analysis",
                "OV explicitly requests \"use Opus\" or \"best quality\"",
            ];

            const clientTasks = selectedClient
                ? tasks.filter(t => t.category.toLowerCase() === selectedClient.taskCategory.toLowerCase())
                : [];

            const clientMeetings = selectedClient ? [] : [];
            const clientActivity = selectedClient ? [] : [];

            const formatNoteTime = (iso) => {
                try {
                    return new Date(iso).toLocaleString();
                } catch (err) {
                    return iso;
                }
            };

            useEffect(() => {
                if (selectedClient?.id) {
                    setNoteLinkedTo(selectedClient.id);
                }
            }, [selectedClient?.id]);

            const resolveNoteLinkLabel = (linkedTo) => {
                if (linkedTo === "personal") return "Personal";
                if (linkedTo === null || linkedTo === undefined || linkedTo === "") return "Global";
                const client = clientsData.find(c => c.id === linkedTo);
                return client ? client.name : "Client";
            };

            const notesSorted = [...notes].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const clientNotes = selectedClient ? notesSorted.filter(note => note.linkedTo === selectedClient.id) : [];
            const personalScopedNotes = notesSorted.filter(note => note.linkedTo === "personal" || note.linkedTo === null || note.linkedTo === undefined || note.linkedTo === "");
            const globalNotesFiltered = notesSorted.filter(note => {
                if (noteFilter === "linked") return note.linkedTo && note.linkedTo !== "personal";
                if (noteFilter === "personal") return note.linkedTo === "personal";
                if (noteFilter === "global") return note.linkedTo === null || note.linkedTo === undefined || note.linkedTo === "";
                return true;
            });
            
            return (
                <div className={`${selectedClient ? "w-full px-6 lg:px-10 py-6" : "max-w-7xl mx-auto p-6"} app-shell`}>
                    {/* HEADER */}
                    <div className="flex justify-between items-start mb-8">
                        <div>
                            <h1 className="text-5xl md:text-6xl font-bold gradient-text mb-2 tracking-tight">Ov</h1>
                            <p className="text-gray-400 text-base md:text-lg">Command Center</p>
                        </div>
                        <div className="text-right">
                            <div className="text-3xl font-bold text-green-400 mono">${(totalRev/1000).toFixed(1)}k<span className="text-sm text-gray-500">/mo</span></div>
                            <div className="text-sm text-gray-500 mono">${(totalProfit/1000).toFixed(1)}k profit</div>
                        </div>
                    </div>
                    
                    {/* NAVIGATION */}
                    <div className="flex gap-6 border-b border-white/5 mb-8 overflow-x-auto pb-3 px-2 glass-quiet rounded-2xl">
                        {navTabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => { setActiveTab(tab.id); setSelectedClient(null); setActiveProjectModal(null); }}
                                className={`pb-3 px-2 whitespace-nowrap text-sm ${tab.id === "aiworkforce" ? "normal-case tracking-normal" : "uppercase tracking-wide capitalize"} ${activeTab === tab.id ? "tab-active" : "text-gray-500 hover:text-gray-200"}`}
                            >
                                {tab.label}
                            </button>
                        ))}
                    </div>
                    
                    {/* DASHBOARD TAB */}
                    {activeTab === "dashboard" && !selectedClient && (
                        <>
                            {/* STATS ROW */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10 stagger">
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="text-3xl font-bold text-indigo-300 mono">{tasks.length}</div>
                                    <div className="text-sm text-gray-400">Business Tasks</div>
                                    <div className="text-xs text-red-400 mt-1">{pendingTasks} pending</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="text-3xl font-bold text-amber-300 mono">{personal.length}</div>
                                    <div className="text-sm text-gray-400">Personal Tasks</div>
                                    <div className="text-xs text-gray-500 mt-1">{personal.filter(t => !t.done).length} pending</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="text-3xl font-bold text-green-300 mono">${(totalRev * 12 / 1000).toFixed(0)}k</div>
                                    <div className="text-sm text-gray-400">Annual Revenue</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="text-3xl font-bold text-purple-300 mono">{emergencyDone}/{emergency.length}</div>
                                    <div className="text-sm text-gray-400">Emergency Prep</div>
                                    <div className="progress-bar mt-2 h-2">
                                        <div className="progress-fill bg-purple-500" style={{width: `${emergencyProgress}%`}}></div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* CLIENTS OVERVIEW */}
                            <h2 className="text-xl font-semibold mb-4">Clients & Roles</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8 stagger">
                                {clientsData.map(client => (
                                    <div 
                                        key={client.id} 
                                        className="glass client-card rounded-2xl p-5"
                                        style={{borderTop: `3px solid ${client.color}`}}
                                        onClick={() => openClient(client)}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="font-semibold text-lg">{client.name}</h3>
                                            <span className={`text-xs ${getContactClass(client.contactStatus)}`}>{client.lastContact}</span>
                                        </div>
                                        {client.brand && <span className="text-xs text-gray-500 block mb-2">{client.brand}</span>}
                                        {client.revenue > 0 && (
                                            <div className="text-green-400 font-semibold mb-2">${client.revenue.toLocaleString()}/mo</div>
                                        )}
                                        <div className="progress-bar h-2 mb-2">
                                            <div className="progress-fill" style={{width: `${client.progress}%`, background: client.color}}></div>
                                        </div>
                                        <div className="text-xs text-gray-500">{client.tasksDone}/{client.tasksTotal} tasks â€¢ Click for details â†’</div>
                                    </div>
                                ))}
                            </div>
                            
                            {/* URGENT TASKS */}
                            <h2 className="text-xl font-semibold mb-4">Due Today/Tonight</h2>
                            <div className="glass rounded-xl divide-y divide-gray-800">
                                {tasks.filter(t => !t.done && (t.due === "Tonight" || t.due === "Today")).map(t => (
                                    <div key={t.id} className="p-4 flex items-center gap-3">
                                        <input 
                                            type="checkbox" 
                                            checked={t.done}
                                            onChange={() => completeTask(t, "business")}
                                            className="w-5 h-5 rounded border-gray-600 bg-gray-800 ui-checkbox"
                                        />
                                        <div className="flex-1">
                                            <div className="text-gray-200">{t.title}</div>
                                            <div className="flex gap-2 mt-1">
                                                <span className="text-xs bg-gray-800 px-2 py-1 rounded">{t.category}</span>
                                                <span className={`text-xs ${t.priority === "high" ? "text-red-400" : "text-yellow-400"}`}>{t.due}</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {tasks.filter(t => !t.done && (t.due === "Tonight" || t.due === "Today")).length === 0 && (
                                    <div className="p-4 text-gray-500">No urgent tasks! ðŸŽ‰</div>
                                )}
                            </div>
                        </>
                    )}
                    
                    {/* CLIENT DETAIL VIEW */}
                    {selectedClient && (
                        <div className="space-y-8">
                            <button 
                                onClick={() => { setSelectedClient(null); setActiveTab("clients"); }}
                                className="text-gray-400 hover:text-white flex items-center gap-2"
                            >
                                â† Back to Client List
                            </button>
                            
                            <div className="grid grid-cols-1 lg:grid-cols-[260px,1fr] xl:grid-cols-[280px,1fr] gap-8">
                                <div className="glass rounded-2xl p-5 h-fit sticky top-6">
                                    <div className="mb-5">
                                        <div className="text-xs uppercase tracking-widest text-gray-500">Client</div>
                                        <div className="text-xl font-semibold mt-1">{selectedClient.name}</div>
                                        {selectedClient.brand && <div className="text-sm text-gray-500 mt-1">{selectedClient.brand}</div>}
                                        <div className={`text-xs mt-2 ${getContactClass(selectedClient.contactStatus)}`}>Last contact: {selectedClient.lastContact}</div>
                                    </div>
                                    <div className="space-y-1">
                                        {detailSections.map(section => (
                                            <button
                                                key={section.id}
                                                onClick={() => setDetailTab(section.id)}
                                                className={`w-full text-left px-3 py-2 rounded-lg text-sm ${detailTab === section.id ? "bg-indigo-500/20 text-indigo-200 border border-indigo-500/30" : "text-gray-400 hover:text-gray-200 hover:bg-white/5"}`}
                                            >
                                                {section.label}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="mt-6 rounded-xl border border-gray-800 bg-black/30 p-4">
                                        <div className="text-xs text-gray-500">Revenue</div>
                                        {selectedClient.revenue > 0 ? (
                                            <div className="text-lg font-semibold text-green-400">${selectedClient.revenue.toLocaleString()}<span className="text-xs text-gray-500">/mo</span></div>
                                        ) : (
                                            <div className="text-xs text-gray-500">Tracked as needed</div>
                                        )}
                                        <div className="text-xs text-gray-500 mt-2">Progress</div>
                                        <div className="progress-bar h-2 mt-1">
                                            <div className="progress-fill" style={{width: `${selectedClient.progress}%`, background: selectedClient.color}}></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="glass rounded-2xl p-8" style={{borderLeft: `4px solid ${selectedClient.color}`}}>
                                    <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-6 mb-8">
                                        <div>
                                            <h2 className="text-3xl font-bold">{detailSections.find(s => s.id === detailTab)?.label}</h2>
                                            <p className="text-gray-500 text-sm">Client workspace for {selectedClient.taskCategory}</p>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs uppercase tracking-widest text-gray-500">Tasks</div>
                                            <div className="text-xl font-semibold text-gray-200">{selectedClient.tasksDone}/{selectedClient.tasksTotal} complete</div>
                                        </div>
                                    </div>

                                    {detailTab === "overview" && (
                                        <div className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                                                <div className="bg-black/20 rounded-2xl p-5">
                                                    <div className="text-xs text-gray-500 uppercase tracking-wide">Focus</div>
                                                    <div className="text-lg font-semibold mt-1">Current sprint</div>
                                                    <div className="text-sm text-gray-400 mt-2">Deliverables aligned to {selectedClient.taskCategory} milestones.</div>
                                                </div>
                                                <div className="bg-black/20 rounded-2xl p-5">
                                                    <div className="text-xs text-gray-500 uppercase tracking-wide">Pipeline</div>
                                                    <div className="text-lg font-semibold mt-1">{clientTasks.filter(t => !t.done).length} open tasks</div>
                                                    <div className="text-sm text-gray-400 mt-2">Next check-in: {selectedClient.lastContact}</div>
                                                </div>
                                                <div className="bg-black/20 rounded-2xl p-5">
                                                    <div className="text-xs text-gray-500 uppercase tracking-wide">Momentum</div>
                                                    <div className="text-lg font-semibold mt-1">{selectedClient.progress}% complete</div>
                                                    <div className="progress-bar h-2 mt-3">
                                                        <div className="progress-fill" style={{width: `${selectedClient.progress}%`, background: selectedClient.color}}></div>
                                                    </div>
                                                </div>
                                            </div>

                                            {selectedClient.meetingNotes && (
                                                <div className="bg-black/20 rounded-2xl p-5">
                                                    <div className="text-sm text-gray-400 mb-2">Latest meeting note</div>
                                                    <div className="text-gray-300">{selectedClient.meetingNotes}</div>
                                                </div>
                                            )}

                                            <div>
                                                <div className="text-sm text-gray-400 mb-3">Recent tasks</div>
                                                <div className="space-y-3">
                                                    {clientTasks.slice(0, 3).map(t => (
                                                        <div key={t.id} className="flex items-center gap-3 bg-black/20 rounded-xl p-4">
                                                            <div className={`w-2 h-2 rounded-full ${t.done ? "bg-green-400" : "bg-yellow-400"}`}></div>
                                                            <div className="flex-1">
                                                                <div className={t.done ? "line-through text-gray-600" : "text-gray-200"}>{t.title}</div>
                                                                <div className="text-xs text-gray-500 mt-1">{t.due}</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {clientTasks.length === 0 && (
                                                        <div className="text-gray-500">No tasks for this client yet.</div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {detailTab === "tasks" && (
                                        <div className="space-y-5">
                                            <div className="bg-black/20 rounded-2xl p-5 flex flex-col md:flex-row gap-4 md:items-center">
                                                <div className="flex-1">
                                                    <div className="text-sm text-gray-400 mb-2">Quick add</div>
                                                    <input
                                                        value={quickTaskText}
                                                        onChange={(e) => setQuickTaskText(e.target.value)}
                                                        onKeyDown={(e) => { if (e.key === "Enter") addQuickTask(); }}
                                                        placeholder={`Add a task for ${selectedClient.name}`}
                                                        className="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200 text-base"
                                                    />
                                                </div>
                                                <button
                                                    onClick={addQuickTask}
                                                    className="px-5 py-3 rounded-xl bg-indigo-500/20 text-indigo-200 border border-indigo-500/40 text-sm uppercase tracking-wide"
                                                >
                                                    Add Task
                                                </button>
                                            </div>
                                            <div className="space-y-3">
                                                {clientTasks.map(t => (
                                                    <div key={t.id} className="flex items-center gap-3 bg-black/20 rounded-xl p-4">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={t.done}
                                                            onChange={() => completeTask(t, "business")}
                                                            className="w-5 h-5 rounded border-gray-600 bg-gray-800 ui-checkbox"
                                                        />
                                                        <div className="flex-1">
                                                            <div className={t.done ? "line-through text-gray-600" : "text-gray-200"}>{t.title}</div>
                                                            <div className="flex gap-2 mt-1">
                                                                <span className="text-xs bg-gray-800 px-2 py-1 rounded">{t.priority}</span>
                                                                <span className="text-xs text-gray-500">{t.due}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                                {clientTasks.length === 0 && (
                                                    <div className="text-gray-500">No tasks for this client yet.</div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {detailTab === "meetings" && (
                                        <div className="space-y-4">
                                            {clientMeetings.map(meeting => (
                                                <div key={meeting.id} className="bg-black/20 rounded-2xl p-5">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <div className="font-semibold text-gray-200">{meeting.title}</div>
                                                            <div className="text-xs text-gray-500 mt-1">{meeting.date}</div>
                                                        </div>
                                                        <span className={`text-xs uppercase tracking-wide ${meeting.status === "completed" ? "text-green-400" : "text-yellow-400"}`}>
                                                            {meeting.status}
                                                        </span>
                                                    </div>
                                                    <div className="text-sm text-gray-400 mt-3">{meeting.notes}</div>
                                                </div>
                                            ))}
                                            {clientMeetings.length === 0 && (
                                                <div className="bg-black/20 rounded-2xl p-5 text-gray-500">No meetings yet.</div>
                                            )}
                                        </div>
                                    )}

                                    {detailTab === "notes" && (
                                        <div className="space-y-5">
                                            <div className="bg-black/20 rounded-2xl p-5">
                                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
                                                    <div>
                                                        <div className="text-sm text-gray-400">Quick add</div>
                                                        <div className="text-xs text-gray-500">Linked to {selectedClient.name}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => addNote(selectedClient.id)}
                                                        className="px-4 py-2 rounded-xl bg-indigo-500/20 text-indigo-200 border border-indigo-500/40 text-xs uppercase tracking-wide"
                                                    >
                                                        Save Note
                                                    </button>
                                                </div>
                                                <div className="space-y-3">
                                                    <input
                                                        value={noteTag}
                                                        onChange={(e) => setNoteTag(e.target.value)}
                                                        placeholder="Tag (optional)"
                                                        className="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200"
                                                    />
                                                    <textarea
                                                        value={noteDraft}
                                                        onChange={(e) => setNoteDraft(e.target.value)}
                                                        rows="6"
                                                        className="w-full bg-black/30 border border-gray-700 rounded-2xl p-4 text-gray-200 text-base"
                                                        placeholder={`Capture a note for ${selectedClient.name}...`}
                                                    />
                                                </div>
                                            </div>
                                            <div className="space-y-4">
                                                {clientNotes.map(note => (
                                                    <div key={note.id} className="bg-black/20 rounded-2xl p-4 space-y-3">
                                                        <div className="flex items-center justify-between text-xs text-gray-500">
                                                            <span>{formatNoteTime(note.timestamp)}</span>
                                                            <span className="px-2 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-500/30">Client</span>
                                                        </div>
                                                        <input
                                                            value={note.tag || ""}
                                                            onChange={(e) => updateNote(note.id, { tag: e.target.value })}
                                                            placeholder="Tag"
                                                            className="w-full bg-black/30 border border-gray-700 rounded-xl px-3 py-2 text-gray-200 text-sm"
                                                        />
                                                        <textarea
                                                            value={note.content}
                                                            onChange={(e) => updateNote(note.id, { content: e.target.value })}
                                                            rows="5"
                                                            className="w-full bg-black/30 border border-gray-700 rounded-2xl p-4 text-gray-200 text-base"
                                                        />
                                                    </div>
                                                ))}
                                                {clientNotes.length === 0 && (
                                                    <div className="text-gray-500">No notes linked to this client yet.</div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {detailTab === "research" && (
                                        <div className="space-y-4">
                                            {selectedClient.research && (
                                                <div className="bg-black/20 rounded-2xl p-5">
                                                    <div className="text-sm text-gray-400 mb-2">Key research</div>
                                                    <div className="text-gray-300">{selectedClient.research}</div>
                                                </div>
                                            )}
                                            <div className="bg-black/20 rounded-2xl p-5 text-sm text-gray-400">
                                                Use the Notes section to capture linked updates, decisions, and follow-ups.
                                            </div>
                                        </div>
                                    )}

                                    {detailTab === "files" && (
                                        <div className="space-y-4">
                                            <div className="text-sm text-gray-400">Documents</div>
                                            <div className="border border-dashed border-gray-700 rounded-xl p-6 text-center text-gray-500 bg-black/20">
                                                Drop files here or click to upload (placeholder)
                                            </div>
                                            {selectedClient.docs.length > 0 && (
                                                <div className="flex flex-wrap gap-2">
                                                    {selectedClient.docs.map((doc, i) => (
                                                        <span key={i} className="text-xs bg-gray-800 px-3 py-1 rounded-full">{doc}</span>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {detailTab === "activity" && (
                                        <div className="space-y-4">
                                            {clientActivity.map(item => (
                                                <div key={item.id} className="flex gap-3">
                                                    <div className="flex flex-col items-center">
                                                        <div className="w-2 h-2 rounded-full bg-indigo-400 mt-2"></div>
                                                        <div className="flex-1 w-px bg-gray-800"></div>
                                                    </div>
                                                    <div className="bg-black/20 rounded-2xl p-5 flex-1">
                                                        <div className="text-xs text-gray-500">{item.time}</div>
                                                        <div className="text-gray-200 mt-1">{item.text}</div>
                                                    </div>
                                                </div>
                                            ))}
                                            {clientActivity.length === 0 && (
                                                <div className="bg-black/20 rounded-2xl p-5 text-gray-500">No activity yet.</div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* CLIENTS LIST TAB */}
                    {activeTab === "clients" && !selectedClient && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {clientsData.map(client => (
                                <div 
                                    key={client.id} 
                                    className="glass client-card rounded-xl p-5"
                                    style={{borderLeft: `4px solid ${client.color}`}}
                                    onClick={() => openClient(client)}
                                >
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="font-semibold text-lg">{client.name}</h3>
                                            {client.brand && <p className="text-sm text-gray-500">{client.brand}</p>}
                                        </div>
                                        <span className={`text-sm ${getContactClass(client.contactStatus)}`}>{client.lastContact}</span>
                                    </div>
                                    {client.revenue > 0 && (
                                        <div className="text-green-400 font-semibold mt-2">${client.revenue.toLocaleString()}/mo</div>
                                    )}
                                    <div className="mt-3">
                                        <div className="flex justify-between text-sm text-gray-500 mb-1">
                                            <span>Progress</span>
                                            <span>{client.progress}%</span>
                                        </div>
                                        <div className="progress-bar h-2">
                                            <div className="progress-fill" style={{width: `${client.progress}%`, background: client.color}}></div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* TASKS TAB */}
                    {activeTab === "tasks" && (
                        <>
                            <div className="flex flex-col lg:flex-row lg:items-center gap-3 mb-6">
                                <div className="flex gap-2 flex-wrap">
                                    {[
                                        { id: "all", label: "All" },
                                        { id: "business", label: "Business" },
                                        { id: "personal", label: "Personal" },
                                        { id: "client", label: "By Client" },
                                    ].map(filter => (
                                        <button
                                            key={filter.id}
                                            onClick={() => setTaskFilter(filter.id)}
                                            className={`px-3 py-1 rounded-full text-xs uppercase tracking-wide ${taskFilter === filter.id ? "bg-indigo-500/20 text-indigo-300 border border-indigo-500/40" : "bg-gray-800 text-gray-400 border border-gray-800 hover:text-gray-200"}`}
                                        >
                                            {filter.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex-1 flex flex-col sm:flex-row gap-3">
                                    {taskFilter === "client" && (
                                        <select
                                            value={clientFilter}
                                            onChange={(e) => setClientFilter(e.target.value)}
                                            className="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm"
                                        >
                                            {clientsData.map(client => (
                                                <option key={client.id} value={client.taskCategory}>{client.name}</option>
                                            ))}
                                        </select>
                                    )}
                                    <input
                                        type="text"
                                        placeholder="Search tasks..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"
                                    />
                                </div>
                            </div>
                            <div className="glass rounded-xl divide-y divide-gray-800">
                                {filteredTasks.map(t => {
                                    const isEditing = editingTaskId === t.id && editingTaskType === t.type;
                                    return (
                                        <div
                                            key={`${t.type}-${t.id}`}
                                            className={`p-4 flex items-center gap-3 border-l-2 group ${isEditing ? "bg-white/5" : ""}`}
                                            style={{ borderColor: t.type === "business" ? getClientColor(t.category) : "#f472b6" }}
                                        >
                                            <input 
                                                type="checkbox" 
                                                checked={t.done}
                                                disabled={isEditing}
                                                onChange={() => completeTask(t, t.type)}
                                                className="w-5 h-5 rounded border-gray-600 bg-gray-800 disabled:opacity-60 ui-checkbox"
                                            />
                                            {isEditing ? (
                                                <>
                                                    <div className="flex-1">
                                                        <div className="flex flex-col sm:flex-row sm:items-center gap-2">
                                                            <input
                                                                value={editForm.title}
                                                                onChange={(e) => {
                                                                    setEditForm(prev => ({ ...prev, title: e.target.value }));
                                                                    if (editError && e.target.value.trim()) setEditError("");
                                                                }}
                                                                onKeyDown={handleEditKeyDown}
                                                                placeholder="Title"
                                                                className={`flex-1 bg-black/30 border rounded-lg px-3 py-2 text-sm text-gray-200 ${editError ? "border-red-500/70" : "border-gray-700"}`}
                                                            />
                                                            <select
                                                                value={editForm.category}
                                                                onChange={(e) => setEditForm(prev => ({ ...prev, category: e.target.value }))}
                                                                onKeyDown={handleEditKeyDown}
                                                                className="w-full sm:w-[120px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                            >
                                                                {t.type === "business" ? (
                                                                    clientsData.map(client => (
                                                                        <option key={client.id} value={client.taskCategory}>{client.taskCategory}</option>
                                                                    ))
                                                                ) : (
                                                                    <option value="Personal">Personal</option>
                                                                )}
                                                            </select>
                                                            <select
                                                                value={editForm.priority}
                                                                onChange={(e) => setEditForm(prev => ({ ...prev, priority: e.target.value }))}
                                                                onKeyDown={handleEditKeyDown}
                                                                className="w-full sm:w-[100px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                            >
                                                                {["critical", "high", "medium", "low"].map(level => (
                                                                    <option key={level} value={level}>{level}</option>
                                                                ))}
                                                            </select>
                                                            <input
                                                                value={editForm.due}
                                                                onChange={(e) => setEditForm(prev => ({ ...prev, due: e.target.value }))}
                                                                onKeyDown={handleEditKeyDown}
                                                                placeholder="Due"
                                                                className="w-full sm:w-[100px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                            />
                                                        </div>
                                                        {editError && <div className="text-xs text-red-400 mt-1">{editError}</div>}
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={saveEditTask}
                                                            className="px-2.5 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-200 border border-emerald-500/40 text-xs uppercase tracking-wide"
                                                        >
                                                            Save
                                                        </button>
                                                        <button
                                                            onClick={cancelEditTask}
                                                            className="px-2.5 py-1.5 rounded-lg bg-gray-800 text-gray-300 border border-gray-700 text-xs uppercase tracking-wide"
                                                        >
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </>
                                            ) : (
                                                <>
                                                    <div className="flex-1">
                                                        <div className={t.done ? "line-through text-gray-600" : "text-gray-200"}>{t.title}</div>
                                                        <div className="flex gap-2 mt-1">
                                                            {t.type === "business" ? (
                                                                <>
                                                                    <span
                                                                        className="text-xs px-2 py-1 rounded-full border"
                                                                        style={{ borderColor: getClientColor(t.category), color: getClientColor(t.category), background: "rgba(15, 23, 42, 0.4)" }}
                                                                    >
                                                                        {t.category}
                                                                    </span>
                                                                    <span className={`text-xs ${t.priority === "high" ? "text-red-400" : t.priority === "medium" ? "text-yellow-400" : "text-gray-400"}`}>{t.priority}</span>
                                                                    <span className="text-xs text-gray-500">{t.due}</span>
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <span className="text-xs px-2 py-1 rounded-full bg-pink-500/20 text-pink-300 border border-pink-500/40">Personal</span>
                                                                    <span className="text-xs text-gray-500">{t.category}</span>
                                                                </>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => startEditTask(t)}
                                                        className="text-xs uppercase tracking-wide text-white px-3 py-1.5 rounded-lg bg-indigo-500/30 border border-indigo-500/50 hover:bg-indigo-500/50 transition"
                                                    >
                                                        Edit
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    );
                                })}
                                {filteredTasks.length === 0 && (
                                    <div className="p-4 text-gray-500">No tasks match this view.</div>
                                )}
                            </div>
                            <div className="flex flex-wrap items-center gap-3 mt-4">
                                <button
                                    onClick={() => setShowCompleted(prev => !prev)}
                                    className="text-xs uppercase tracking-wide text-gray-400 hover:text-gray-200 border border-gray-700 px-3 py-1 rounded-full"
                                >
                                    {showCompleted ? "Hide Completed" : `Show Completed (${filteredCompleted.length})`}
                                </button>
                                <button
                                    onClick={clearCompleted}
                                    disabled={completedTasks.length === 0}
                                    className={`text-xs uppercase tracking-wide border px-3 py-1 rounded-full ${completedTasks.length === 0 ? "border-gray-800 text-gray-600 cursor-not-allowed" : "border-gray-700 text-gray-400 hover:text-gray-200"}`}
                                >
                                    Clear Completed
                                </button>
                            </div>
                            {showCompleted && (
                                <div className="glass rounded-xl divide-y divide-gray-800 mt-4">
                                    {filteredCompleted.map(t => (
                                        <div
                                            key={`completed-${t.type}-${t.id}`}
                                            className="p-3 flex items-center gap-3 border-l-2 text-sm opacity-70"
                                            style={{ borderColor: t.type === "business" ? getClientColor(t.category) : "#f472b6" }}
                                        >
                                            <input 
                                                type="checkbox" 
                                                checked={true}
                                                onChange={() => restoreTask(t)}
                                                className="w-4 h-4 rounded border-gray-600 bg-gray-800 ui-checkbox"
                                            />
                                            <div className="flex-1">
                                                <div className="line-through text-gray-500">{t.title}</div>
                                                <div className="flex gap-2 mt-1">
                                                    {t.type === "business" ? (
                                                        <>
                                                            <span
                                                                className="text-[10px] px-2 py-0.5 rounded-full border"
                                                                style={{ borderColor: getClientColor(t.category), color: getClientColor(t.category), background: "rgba(15, 23, 42, 0.4)" }}
                                                            >
                                                                {t.category}
                                                            </span>
                                                            {t.priority && (
                                                                <span className="text-[10px] text-gray-500">{t.priority}</span>
                                                            )}
                                                            {t.due && (
                                                                <span className="text-[10px] text-gray-600">{t.due}</span>
                                                            )}
                                                        </>
                                                    ) : (
                                                        <>
                                                            <span className="text-[10px] px-2 py-0.5 rounded-full bg-pink-500/10 text-pink-300 border border-pink-500/30">Personal</span>
                                                            <span className="text-[10px] text-gray-600">{t.category}</span>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {filteredCompleted.length === 0 && (
                                        <div className="p-4 text-gray-500 text-sm">No completed tasks in this view.</div>
                                    )}
                                </div>
                            )}
                        </>
                    )}

                    {/* AI WORKFORCE TAB */}
                    {activeTab === "aiworkforce" && (
                        <div className="space-y-6">
                            <div className="glass rounded-2xl p-6 md:p-7">
                                <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-3 mb-6">
                                    <div>
                                        <div className="text-xs uppercase tracking-[0.22em] text-indigo-300">Chain Of Command</div>
                                        <h2 className="text-3xl md:text-4xl font-bold gradient-text mt-1">AI Workforce</h2>
                                        <p className="text-sm text-gray-400 mt-2">Always-on execution stack with controlled escalation and cost discipline.</p>
                                    </div>
                                    <div className="badge px-3 py-1.5 text-xs uppercase tracking-wide text-cyan-200 border border-cyan-400/30">Glass Ops Matrix</div>
                                </div>

                                <div className="rounded-2xl border border-indigo-400/20 bg-black/20 p-4 md:p-6">
                                    <div className="max-w-4xl mx-auto">
                                        <div className="workforce-node rounded-xl p-4 md:p-5 text-center max-w-sm mx-auto">
                                            <div className="text-xs uppercase tracking-widest text-gray-500">Top Command</div>
                                            <div className="text-xl font-bold text-white mt-1">OV</div>
                                            <div className="text-sm text-gray-400">Owner</div>
                                        </div>

                                        <div className="flex justify-center text-indigo-300 text-xl my-2">â†“</div>

                                        <div className="workforce-node rounded-xl p-4 md:p-5 text-center max-w-md mx-auto">
                                            <div className="flex items-center justify-center gap-2 text-xs uppercase tracking-widest text-emerald-300">
                                                <span className="status-dot bg-emerald-400"></span>Always On
                                            </div>
                                            <div className="text-xl font-bold text-white mt-1">Aiden ðŸŒ€</div>
                                            <div className="text-sm text-gray-400">Chief of Staff</div>
                                        </div>

                                        <div className="hidden md:block mt-4 px-10">
                                            <div className="h-px bg-gradient-to-r from-emerald-400/40 via-cyan-400/40 to-sky-400/40"></div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 stagger">
                                            <div className="space-y-2">
                                                <div className="hidden md:flex justify-center">
                                                    <div className="h-4 w-px bg-emerald-400/50"></div>
                                                </div>
                                                <div className="flex justify-center text-emerald-300 text-lg">â†“</div>
                                                <div className="workforce-node workforce-node-end rounded-xl p-5 hover-lift">
                                                    <div className="text-xs uppercase tracking-widest text-emerald-300 mb-3">ENGINEERING</div>
                                                    <div className="space-y-2">
                                                        <div className="rounded-xl bg-black/25 border border-emerald-500/20 p-3">
                                                            <div className="font-semibold text-emerald-100">Codex 5.3</div>
                                                            <div className="text-xs text-gray-400 mt-1">Lead Engineer</div>
                                                        </div>
                                                        <div className="flex justify-center text-emerald-300">â†“</div>
                                                        <div className="rounded-xl bg-black/25 border border-rose-500/20 p-3">
                                                            <div className="font-semibold text-rose-100">Opus 4.5</div>
                                                            <div className="text-xs text-gray-400 mt-1">Senior Engineer</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-2">
                                                <div className="hidden md:flex justify-center">
                                                    <div className="h-4 w-px bg-cyan-400/50"></div>
                                                </div>
                                                <div className="flex justify-center text-cyan-300 text-lg">â†“</div>
                                                <div className="workforce-node workforce-node-end rounded-xl p-5 hover-lift">
                                                    <div className="text-xs uppercase tracking-widest text-cyan-300 mb-3">RESEARCH</div>
                                                    <div className="space-y-2">
                                                        <div className="rounded-xl bg-black/25 border border-cyan-500/20 p-3">
                                                            <div className="font-semibold text-cyan-100">Sonnet 4.5</div>
                                                            <div className="text-xs text-gray-400 mt-1">Research Analyst</div>
                                                        </div>
                                                        <div className="flex justify-center text-cyan-300">â†“</div>
                                                        <div className="rounded-xl bg-black/25 border border-amber-500/20 p-3">
                                                            <div className="font-semibold text-amber-100">Opus 4.6</div>
                                                            <div className="text-xs text-gray-400 mt-1">Senior Research</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-2">
                                                <div className="hidden md:flex justify-center">
                                                    <div className="h-4 w-px bg-sky-400/50"></div>
                                                </div>
                                                <div className="flex justify-center text-sky-300 text-lg">â†“</div>
                                                <div className="workforce-node workforce-node-end rounded-xl p-5 hover-lift">
                                                    <div className="text-xs uppercase tracking-widest text-sky-300 mb-3">OPERATIONS</div>
                                                    <div className="space-y-2">
                                                        <div className="rounded-xl bg-black/25 border border-sky-500/20 p-3">
                                                            <div className="font-semibold text-sky-100">Browser Use</div>
                                                            <div className="text-xs text-gray-400 mt-1">Field Agent</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="glass rounded-2xl p-6 md:p-7">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-2xl font-semibold">Agent Roster</h3>
                                    <div className="text-xs uppercase tracking-wide text-gray-500">{workforceAgents.length} agents</div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 stagger">
                                    {workforceAgents.map(agent => (
                                        <div key={agent.name} className="glass rounded-2xl p-4 hover-lift">
                                            <div className={`rounded-xl bg-gradient-to-br ${agent.accent} border border-white/10 p-3 mb-3`}>
                                                <div className="flex items-start justify-between gap-3">
                                                    <div>
                                                        <div className="text-lg font-semibold text-white">{agent.name}</div>
                                                        <div className="text-sm text-gray-300">{agent.role}</div>
                                                    </div>
                                                    <span className={`text-[10px] uppercase tracking-wide px-2 py-1 rounded-full border ${agent.status === "active" ? "border-emerald-400/40 text-emerald-300 bg-emerald-500/10" : "border-amber-400/40 text-amber-300 bg-amber-500/10"}`}>{agent.status}</span>
                                                </div>
                                                <div className="text-xs text-gray-300 mt-2">{agent.model}</div>
                                            </div>
                                            <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">Cost Tier</div>
                                            <div className="mono text-sm text-indigo-200 mb-3">{agent.costTier}</div>
                                            <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">Capabilities</div>
                                            <div className="flex flex-wrap gap-2 mb-3">
                                                {agent.capabilities.map(capability => (
                                                    <span key={`${agent.name}-${capability}`} className="px-2 py-1 rounded-full border border-gray-700 bg-black/20 text-[11px] text-gray-300">{capability}</span>
                                                ))}
                                            </div>
                                            <p className="text-sm text-gray-400">{agent.description}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 xl:grid-cols-[1.2fr,1fr] gap-6">
                                <div className="glass rounded-2xl p-6 md:p-7">
                                    <h3 className="text-2xl font-semibold mb-4">Tools Panel</h3>
                                    <div className="space-y-3">
                                        {workforceTools.map(tool => (
                                            <div key={tool.name} className="flex items-center justify-between gap-3 rounded-xl border border-gray-700/70 bg-black/20 px-4 py-3 hover-lift">
                                                <div>
                                                    <div className="text-sm font-semibold text-gray-100">{tool.name}</div>
                                                    <div className="text-xs text-gray-400">{tool.detail}</div>
                                                </div>
                                                <span className="text-[10px] uppercase tracking-wide px-2 py-1 rounded-full border border-emerald-400/40 text-emerald-300 bg-emerald-500/10">active</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div className="glass rounded-2xl p-6 md:p-7">
                                        <h3 className="text-2xl font-semibold mb-4">Escalation Rules</h3>
                                        <div className="space-y-2">
                                            {escalationRules.map(rule => (
                                                <div key={rule} className="rounded-xl border border-rose-400/20 bg-rose-500/5 px-3 py-2 text-sm text-gray-300">
                                                    {rule}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="glass rounded-2xl p-6 md:p-7">
                                        <h3 className="text-2xl font-semibold mb-3">Cost Flow</h3>
                                        <p className="text-sm text-gray-400 mb-4">Free to premium escalation path, optimized for efficiency.</p>
                                        <div className="rounded-xl border border-indigo-400/30 bg-indigo-500/10 px-4 py-3">
                                            <div className="mono text-indigo-200 text-sm md:text-base">Free â†’ $ â†’ $$ â†’ $$$$$</div>
                                            <div className="text-xs uppercase tracking-wide text-gray-400 mt-2">Always start cheap, escalate only when needed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* EMERGENCY PREP TAB */}
                    {activeTab === "emergency" && (
                        <>
                            <div className="glass rounded-xl p-4 mb-6">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-gray-400">Emergency Preparedness Progress</span>
                                    <span className="font-bold text-purple-400">{emergencyDone}/{emergency.length}</span>
                                </div>
                                <div className="progress-bar h-3">
                                    <div className="progress-fill bg-purple-500" style={{width: `${emergencyProgress}%`}}></div>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {emergencyCategoryData.map(category => (
                                    <div key={category.id} className="glass rounded-xl p-4">
                                        <button
                                            onClick={() => setExpandedPrepCategory(expandedPrepCategory === category.id ? null : category.id)}
                                            className="w-full text-left"
                                        >
                                            <div className="flex justify-between items-center mb-3">
                                                <div>
                                                    <h3 className="font-semibold text-gray-200">{category.label}</h3>
                                                    <div className="text-xs text-gray-500">{category.done}/{category.total} complete</div>
                                                </div>
                                                <div className={`text-lg font-semibold ${category.accent}`}>{category.progress}%</div>
                                            </div>
                                            <div className="progress-bar h-2">
                                                <div className={`progress-fill ${category.bar}`} style={{width: `${category.progress}%`}}></div>
                                            </div>
                                        </button>
                                        {expandedPrepCategory === category.id && (
                                            <div className="mt-4 space-y-2">
                                                {category.items.map(item => (
                                                    <label key={item.id} className="flex items-center gap-2 text-sm text-gray-300">
                                                        <input
                                                            type="checkbox"
                                                            checked={item.done}
                                                            onChange={() => toggleTask(item.id, emergency, setEmergency)}
                                                            className="w-4 h-4 rounded border-gray-600 bg-gray-800 ui-checkbox"
                                                        />
                                                        <span className={item.done ? "line-through text-gray-600" : ""}>{item.item}</span>
                                                    </label>
                                                ))}
                                                {category.items.length === 0 && (
                                                    <div className="text-xs text-gray-500">No items in this category yet.</div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </>
                    )}

                    {/* NOTES TAB */}
                    {activeTab === "notes" && (
                        <div className="grid grid-cols-1 xl:grid-cols-[1.2fr,1fr] gap-6">
                            <div className="glass rounded-2xl p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h2 className="text-2xl font-semibold">Notes</h2>
                                        <p className="text-sm text-gray-500">Universal notes system with optional client links.</p>
                                    </div>
                                    <button
                                        onClick={() => addNote()}
                                        className="px-4 py-2 rounded-xl bg-indigo-500/20 text-indigo-200 border border-indigo-500/40 text-sm uppercase tracking-wide"
                                    >
                                        Save Note
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    <select
                                        value={noteLinkedTo ?? ""}
                                        onChange={(e) => {
                                            const value = e.target.value;
                                            setNoteLinkedTo(value === "" ? null : value);
                                        }}
                                        className="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200"
                                    >
                                        <option value="">Global (no link)</option>
                                        <option value="personal">Personal</option>
                                        {clientsData.map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                    <input
                                        value={noteTag}
                                        onChange={(e) => setNoteTag(e.target.value)}
                                        placeholder="Tag (optional)"
                                        className="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200"
                                    />
                                    <textarea
                                        value={noteDraft}
                                        onChange={(e) => setNoteDraft(e.target.value)}
                                        rows="10"
                                        className="w-full bg-black/30 border border-gray-700 rounded-2xl p-4 text-gray-200 text-base"
                                        placeholder="Start typing... notes are saved as you type."
                                    />
                                </div>
                            </div>
                            <div className="glass rounded-2xl p-6">
                                <div className="flex flex-wrap items-center gap-2 mb-4">
                                    {[
                                        { id: "all", label: "All" },
                                        { id: "linked", label: "Linked to Clients" },
                                        { id: "personal", label: "Personal Only" },
                                        { id: "global", label: "Global" },
                                    ].map(filter => (
                                        <button
                                            key={filter.id}
                                            onClick={() => setNoteFilter(filter.id)}
                                            className={`px-3 py-1 rounded-full text-xs uppercase tracking-wide ${noteFilter === filter.id ? "bg-indigo-500/20 text-indigo-300 border border-indigo-500/40" : "bg-gray-800 text-gray-400 border border-gray-800 hover:text-gray-200"}`}
                                        >
                                            {filter.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="space-y-4">
                                    {globalNotesFiltered.map(note => (
                                        <div key={note.id} className="bg-black/20 rounded-2xl p-4">
                                            <div className="flex items-center justify-between text-xs text-gray-500 mb-2">
                                                <span>{formatNoteTime(note.timestamp)}</span>
                                                <span className="px-2 py-1 rounded-full bg-gray-800 text-gray-300 border border-gray-700">{resolveNoteLinkLabel(note.linkedTo)}</span>
                                            </div>
                                            {note.tag && <div className="text-xs text-indigo-200 mb-2">{note.tag}</div>}
                                            <div className="text-gray-200 whitespace-pre-wrap">{note.content}</div>
                                        </div>
                                    ))}
                                    {globalNotesFiltered.length === 0 && (
                                        <div className="text-gray-500">No notes in this filter yet.</div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* BRIEFS TAB */}
                    {activeTab === "briefs" && (
                        <div className="space-y-6">
                            {/* Stats Cards */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 stagger">
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xl">ðŸ“š</span>
                                        <span className="text-xs uppercase tracking-widest text-gray-500">Total</span>
                                    </div>
                                    <div className="text-3xl font-bold text-indigo-300 mono">{briefs.length}</div>
                                    <div className="text-xs text-gray-400 mt-1">Briefs archived</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xl">ðŸ“…</span>
                                        <span className="text-xs uppercase tracking-widest text-gray-500">This Week</span>
                                    </div>
                                    <div className="text-3xl font-bold text-emerald-300 mono">{thisWeekCount}</div>
                                    <div className="text-xs text-gray-400 mt-1">New briefings</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xl">ðŸ””</span>
                                        <span className="text-xs uppercase tracking-widest text-gray-500">Unread</span>
                                    </div>
                                    <div className="text-3xl font-bold text-amber-300 mono">{unreadCount}</div>
                                    <div className="text-xs text-gray-400 mt-1">Need attention</div>
                                </div>
                                <div className="glass rounded-2xl p-5 hover-lift">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xl">ðŸ”„</span>
                                        <span className="text-xs uppercase tracking-widest text-gray-500">Last Update</span>
                                    </div>
                                    <div className="text-lg font-bold text-cyan-300 mono">{lastUpdated}</div>
                                    <div className="text-xs text-gray-400 mt-1">From Atlas</div>
                                </div>
                            </div>

                            {/* Filter Tabs */}
                            <div className="flex flex-wrap gap-2">
                                {["all", "unread", "daily", "crypto"].map(filter => (
                                    <button
                                        key={filter}
                                        onClick={() => setBriefFilter(filter)}
                                        className={`px-4 py-2 rounded-xl text-sm font-medium transition ${
                                            briefFilter === filter 
                                                ? "bg-emerald-500/20 text-emerald-300 border border-emerald-500/40" 
                                                : "bg-black/20 text-gray-400 border border-gray-700 hover:text-gray-200"
                                        }`}
                                    >
                                        {filter.charAt(0).toUpperCase() + filter.slice(1)}
                                    </button>
                                ))}
                            </div>

                            {/* Briefs List */}
                            <div className="space-y-4">
                                {filteredBriefs.length === 0 ? (
                                    <div className="glass rounded-2xl p-8 text-center text-gray-400">
                                        <div className="text-4xl mb-3">ðŸ“Š</div>
                                        <p>No briefings yet.</p>
                                        <p className="text-sm mt-2">Your Atlas daily briefings will appear here.</p>
                                    </div>
                                ) : (
                                    filteredBriefs.map(brief => {
                                        const read = isBriefRead(brief.id);
                                        return (
                                            <div
                                                key={brief.id}
                                                onClick={() => { markBriefAsRead(brief.id); setActiveBriefModal(brief); }}
                                                className={`glass rounded-2xl p-5 cursor-pointer hover-lift transition ${
                                                    read ? "opacity-70" : "border-l-4 border-l-emerald-500/50"
                                                }`}
                                            >
                                                <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <span className="text-2xl">{getTypeIcon(brief.type)}</span>
                                                            <span className={`text-xs uppercase tracking-widest px-2 py-1 rounded-full border ${
                                                                brief.type === "Daily" ? "bg-blue-500/20 text-blue-300 border-blue-500/40" :
                                                                brief.type === "Weekend" ? "bg-purple-500/20 text-purple-300 border-purple-500/40" :
                                                                "bg-amber-500/20 text-amber-300 border-amber-500/40"
                                                            }`}>
                                                                {brief.type}
                                                            </span>
                                                            <span className="text-xs text-gray-500">{brief.date}</span>
                                                            {!read && (
                                                                <span className="text-xs bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded-full border border-emerald-500/40">
                                                                    New
                                                                </span>
                                                            )}
                                                        </div>
                                                        <h3 className={`text-lg font-semibold ${read ? "text-gray-400" : "text-gray-100"}`}>
                                                            {brief.title || `${brief.type} Brief: ${brief.date}`}
                                                        </h3>
                                                        {brief.summary && (
                                                            <p className="text-sm text-gray-400 mt-1 line-clamp-2">{brief.summary}</p>
                                                        )}
                                                        {brief.tickers && (
                                                            <div className="flex flex-wrap gap-2 mt-3">
                                                                {brief.tickers.map(ticker => (
                                                                    <span key={ticker} className="text-xs bg-black/30 px-2 py-1 rounded text-gray-300">
                                                                        ${ticker}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>
                    )}
                    
                    {/* PERSONAL TAB */}
                    {activeTab === "personal" && (
                        <div className="space-y-6">
                            <div className="grid grid-cols-1 xl:grid-cols-[1.1fr,1fr] gap-6">
                                <div className="glass rounded-2xl p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <h2 className="text-2xl font-semibold">Tasks</h2>
                                            <p className="text-sm text-gray-500">Personal backlog with quick add.</p>
                                        </div>
                                    </div>
                                    <div className="bg-black/20 rounded-2xl p-4 mb-5">
                                        <div className="text-xs text-gray-500 uppercase tracking-wide mb-2">Quick add</div>
                                        <div className="flex flex-col md:flex-row gap-3">
                                            <input
                                                value={personalTaskText}
                                                onChange={(e) => setPersonalTaskText(e.target.value)}
                                                onKeyDown={(e) => { if (e.key === "Enter") addPersonalTask(); }}
                                                placeholder="Add a personal task"
                                                className="flex-1 bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200 text-base"
                                            />
                                            <select
                                                value={personalTaskDue}
                                                onChange={(e) => setPersonalTaskDue(e.target.value)}
                                                className="bg-black/30 border border-gray-700 rounded-xl px-3 py-3 text-sm text-gray-300"
                                            >
                                                <option value="none">No due</option>
                                                <option value="today">Today</option>
                                                <option value="tonight">Tonight</option>
                                            </select>
                                            <button
                                                onClick={addPersonalTask}
                                                className="px-4 py-3 rounded-xl bg-pink-500/20 text-pink-200 border border-pink-500/40 text-sm uppercase tracking-wide"
                                            >
                                                Add
                                            </button>
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        {personal.map(t => {
                                            const isEditing = editingTaskId === t.id && editingTaskType === "personal";
                                            return (
                                                <div key={t.id} className={`flex items-center gap-3 bg-black/20 rounded-xl p-4 group ${isEditing ? "bg-white/5" : ""}`}>
                                                    <input 
                                                        type="checkbox" 
                                                        checked={t.done}
                                                        disabled={isEditing}
                                                        onChange={() => completeTask(t, "personal")}
                                                        className="w-5 h-5 rounded border-gray-600 bg-gray-800 disabled:opacity-60 ui-checkbox"
                                                    />
                                                    {isEditing ? (
                                                        <>
                                                            <div className="flex-1">
                                                                <div className="flex flex-col sm:flex-row sm:items-center gap-2">
                                                                    <input
                                                                        value={editForm.title}
                                                                        onChange={(e) => {
                                                                            setEditForm(prev => ({ ...prev, title: e.target.value }));
                                                                            if (editError && e.target.value.trim()) setEditError("");
                                                                        }}
                                                                        onKeyDown={handleEditKeyDown}
                                                                        placeholder="Title"
                                                                        className={`flex-1 bg-black/30 border rounded-lg px-3 py-2 text-sm text-gray-200 ${editError ? "border-red-500/70" : "border-gray-700"}`}
                                                                    />
                                                                    <select
                                                                        value={editForm.category}
                                                                        onChange={(e) => setEditForm(prev => ({ ...prev, category: e.target.value }))}
                                                                        onKeyDown={handleEditKeyDown}
                                                                        className="w-full sm:w-[120px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                                    >
                                                                        <option value="Personal">Personal</option>
                                                                    </select>
                                                                    <select
                                                                        value={editForm.priority}
                                                                        onChange={(e) => setEditForm(prev => ({ ...prev, priority: e.target.value }))}
                                                                        onKeyDown={handleEditKeyDown}
                                                                        className="w-full sm:w-[100px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                                    >
                                                                        {["critical", "high", "medium", "low"].map(level => (
                                                                            <option key={level} value={level}>{level}</option>
                                                                        ))}
                                                                    </select>
                                                                    <input
                                                                        value={editForm.due}
                                                                        onChange={(e) => setEditForm(prev => ({ ...prev, due: e.target.value }))}
                                                                        onKeyDown={handleEditKeyDown}
                                                                        placeholder="Due"
                                                                        className="w-full sm:w-[100px] bg-black/30 border border-gray-700 rounded-lg px-2 py-2 text-sm text-gray-200"
                                                                    />
                                                                </div>
                                                                {editError && <div className="text-xs text-red-400 mt-1">{editError}</div>}
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <button
                                                                    onClick={saveEditTask}
                                                                    className="px-2.5 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-200 border border-emerald-500/40 text-xs uppercase tracking-wide"
                                                                >
                                                                    Save
                                                                </button>
                                                                <button
                                                                    onClick={cancelEditTask}
                                                                    className="px-2.5 py-1.5 rounded-lg bg-gray-800 text-gray-300 border border-gray-700 text-xs uppercase tracking-wide"
                                                                >
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <div className="flex-1">
                                                                <div className={t.done ? "line-through text-gray-600" : "text-gray-200"}>{t.title}</div>
                                                                <div className="flex gap-2 mt-1">
                                                                    <span className="text-xs text-gray-500">{t.category}</span>
                                                                    {t.due && <span className="text-xs text-gray-400">{t.due}</span>}
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => startEditTask(t, "personal")}
                                                                className="text-xs uppercase tracking-wide text-white px-3 py-1.5 rounded-lg bg-pink-500/30 border border-pink-500/50 hover:bg-pink-500/50 transition"
                                                            >
                                                                Edit
                                                            </button>
                                                        </>
                                                    )}
                                                </div>
                                            );
                                        })}
                                        {personal.length === 0 && (
                                            <div className="text-gray-500">No personal tasks yet.</div>
                                        )}
                                    </div>
                                </div>

                                <div className="glass rounded-2xl p-6">
                                    <h2 className="text-2xl font-semibold mb-4">Today</h2>
                                    <div className="space-y-3">
                                        {personal.filter(t => t.due === "Today" || t.due === "Tonight").map(t => (
                                            <div key={t.id} className="bg-black/20 rounded-xl p-4">
                                                <div className="text-sm text-gray-200">{t.title}</div>
                                                <div className="text-xs text-gray-500 mt-1">{t.due}</div>
                                            </div>
                                        ))}
                                        {personal.filter(t => t.due === "Today" || t.due === "Tonight").length === 0 && (
                                            <div className="text-gray-500">No personal tasks due today.</div>
                                        )}
                                    </div>
                                    <div className="mt-6 border-t border-gray-800 pt-5">
                                        <h3 className="text-lg font-semibold mb-3">Goals & Reminders</h3>
                                        <div className="flex gap-3 mb-4">
                                            <input
                                                value={goalText}
                                                onChange={(e) => setGoalText(e.target.value)}
                                                onKeyDown={(e) => { if (e.key === "Enter") addPersonalGoal(); }}
                                                placeholder="Add a goal or reminder"
                                                className="flex-1 bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200"
                                            />
                                            <button
                                                onClick={addPersonalGoal}
                                                className="px-4 py-3 rounded-xl bg-emerald-500/20 text-emerald-200 border border-emerald-500/40 text-sm uppercase tracking-wide"
                                            >
                                                Add
                                            </button>
                                        </div>
                                        <div className="space-y-2">
                                            {personalGoals.map(goal => (
                                                <div key={goal.id} className="bg-black/20 rounded-xl p-3 text-sm text-gray-200">
                                                    {goal.text}
                                                </div>
                                            ))}
                                            {personalGoals.length === 0 && (
                                                <div className="text-gray-500">No goals yet.</div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="glass rounded-2xl p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h2 className="text-2xl font-semibold">Notes</h2>
                                        <p className="text-sm text-gray-500">Personal and global notes.</p>
                                    </div>
                                    <button
                                        onClick={() => addNote("personal")}
                                        className="px-4 py-2 rounded-xl bg-indigo-500/20 text-indigo-200 border border-indigo-500/40 text-sm uppercase tracking-wide"
                                    >
                                        Save Note
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-[1.1fr,1fr] gap-5">
                                    <div className="space-y-3">
                                        <div className="text-xs text-gray-500 uppercase tracking-wide">Quick add</div>
                                        <input
                                            value={noteTag}
                                            onChange={(e) => setNoteTag(e.target.value)}
                                            placeholder="Tag (optional)"
                                            className="w-full bg-black/30 border border-gray-700 rounded-xl px-4 py-3 text-gray-200"
                                        />
                                        <textarea
                                            value={noteDraft}
                                            onChange={(e) => setNoteDraft(e.target.value)}
                                            rows="7"
                                            className="w-full bg-black/30 border border-gray-700 rounded-2xl p-4 text-gray-200 text-base"
                                            placeholder="Type here..."
                                        />
                                    </div>
                                    <div className="space-y-3">
                                        {personalScopedNotes.slice(0, 4).map(note => (
                                            <div key={note.id} className="bg-black/20 rounded-2xl p-4">
                                                <div className="flex items-center justify-between text-xs text-gray-500 mb-2">
                                                    <span>{formatNoteTime(note.timestamp)}</span>
                                                    <span className="px-2 py-1 rounded-full bg-gray-800 text-gray-300 border border-gray-700">{resolveNoteLinkLabel(note.linkedTo)}</span>
                                                </div>
                                                {note.tag && <div className="text-xs text-indigo-200 mb-2">{note.tag}</div>}
                                                <div className="text-gray-200 whitespace-pre-wrap">{note.content}</div>
                                            </div>
                                        ))}
                                        {personalScopedNotes.length === 0 && (
                                            <div className="text-gray-500">No personal or global notes yet.</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeProjectModal && (
                        <div className="fixed inset-0 z-50 bg-black/70 backdrop-blur-sm px-4 py-8 md:py-12 overflow-y-auto">
                            <div className="max-w-3xl mx-auto glass rounded-2xl p-6 md:p-8 border border-indigo-400/30">
                                <div className="flex items-start justify-between gap-4 mb-5">
                                    <div>
                                        <div className="text-xs uppercase tracking-[0.2em] text-gray-500">{activeProjectModal.clientName}</div>
                                        <h3 className="text-2xl font-semibold mt-1">{activeProjectModal.projectName}</h3>
                                        <div className="flex flex-wrap items-center gap-2 mt-3">
                                            <span className="badge px-2.5 py-1 text-[11px] text-gray-300 border-gray-700">{activeProjectModal.type}</span>
                                            <span className={`badge px-2.5 py-1 text-[11px] border ${projectStatusStyles[activeProjectModal.status] || "text-gray-300 border-gray-600 bg-gray-500/10"}`}>
                                                {activeProjectModal.status}
                                            </span>
                                            <span className="mono text-sm text-emerald-300">{activeProjectModal.value}</span>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setActiveProjectModal(null)}
                                        className="btn btn-ghost px-3 py-2 text-xs uppercase tracking-wide"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="rounded-2xl border border-gray-700 bg-black/25 p-4">
                                    <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">Proposal Content</div>
                                    <pre className="whitespace-pre-wrap text-sm text-gray-200 font-sans leading-relaxed">{activeProjectModal.proposalContent}</pre>
                                </div>
                                <div className="mt-4">
                                    <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">Quick Notes</div>
                                    <textarea
                                        value={projects.find(project => project.id === activeProjectModal.id)?.notes || ""}
                                        onChange={(e) => updateProjectField(activeProjectModal.id, "notes", e.target.value)}
                                        rows="3"
                                        className="ui-input rounded-xl px-3 py-3 text-sm w-full"
                                    />
                                </div>
                            </div>
                        </div>
                    )}

                    {/* BRIEFS MODAL */}
                    {activeBriefModal && (
                        <div className="fixed inset-0 z-50 bg-black/70 backdrop-blur-sm px-4 py-8 md:py-12 overflow-y-auto">
                            <div className="max-w-3xl mx-auto glass rounded-2xl p-6 md:p-8 border border-emerald-400/30">
                                <div className="flex items-start justify-between gap-4 mb-5">
                                    <div>
                                        <div className="flex items-center gap-3 mb-2">
                                            <span className="text-3xl">{getTypeIcon(activeBriefModal.type)}</span>
                                            <span className={`text-xs uppercase tracking-widest px-2 py-1 rounded-full border ${
                                                activeBriefModal.type === "Daily" ? "bg-blue-500/20 text-blue-300 border-blue-500/40" :
                                                activeBriefModal.type === "Weekend" ? "bg-purple-500/20 text-purple-300 border-purple-500/40" :
                                                "bg-amber-500/20 text-amber-300 border-amber-500/40"
                                            }`}>
                                                {activeBriefModal.type}
                                            </span>
                                            <span className="text-xs text-gray-500">{activeBriefModal.date}</span>
                                        </div>
                                        <h3 className="text-2xl font-semibold">{activeBriefModal.title}</h3>
                                        {activeBriefModal.sentiment && (
                                            <div className="flex items-center gap-2 mt-2">
                                                <span className="text-sm text-gray-400">Sentiment:</span>
                                                <span className={`text-sm font-medium ${
                                                    activeBriefModal.sentiment.score <= 25 ? "text-red-400" :
                                                    activeBriefModal.sentiment.score <= 50 ? "text-yellow-400" :
                                                    activeBriefModal.sentiment.score <= 75 ? "text-emerald-400" :
                                                    "text-green-400"
                                                }`}>
                                                    {activeBriefModal.sentiment.label} ({activeBriefModal.sentiment.score}/100)
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                    <button
                                        onClick={() => setActiveBriefModal(null)}
                                        className="btn btn-ghost px-3 py-2 text-xs uppercase tracking-wide"
                                    >
                                        Close
                                    </button>
                                </div>
                                
                                {activeBriefModal.tickers && (
                                    <div className="flex flex-wrap gap-2 mb-4">
                                        {activeBriefModal.tickers.map(ticker => (
                                            <span key={ticker} className="text-xs bg-black/30 px-3 py-1.5 rounded-lg text-gray-300 border border-gray-700">
                                                ${ticker}
                                            </span>
                                        ))}
                                    </div>
                                )}
                                
                                {activeBriefModal.pdfUrl ? (
                                    <div className="rounded-2xl border border-gray-700 bg-black/25 p-6 text-center">
                                        <div className="text-5xl mb-4">ðŸ“„</div>
                                        <p className="text-gray-300 mb-4">This brief is available as a PDF</p>
                                        <a 
                                            href={activeBriefModal.pdfUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="btn btn-emerald px-6 py-3 text-sm inline-block"
                                        >
                                            Open PDF
                                        </a>
                                    </div>
                                ) : (
                                    <div className="rounded-2xl border border-gray-700 bg-black/25 p-4 max-h-[60vh] overflow-y-auto">
                                        <pre className="whitespace-pre-wrap text-sm text-gray-200 font-sans leading-relaxed">{activeBriefModal.content}</pre>
                                    </div>
                                )}
                                
                                <div className="flex gap-3 mt-4">
                                    <button
                                        onClick={() => markBriefAsRead(activeBriefModal.id)}
                                        className="btn btn-emerald px-4 py-2 text-sm"
                                    >
                                        Mark as Read
                                    </button>
                                    <button
                                        onClick={() => { markBriefAsRead(activeBriefModal.id); window.open(activeBriefModal.pdfUrl, '_blank'); }}
                                        className="btn btn-ghost px-4 py-2 text-sm"
                                    >
                                        Open & Read
                                    </button>
                                    <button
                                        onClick={() => markBriefAsUnread(activeBriefModal.id)}
                                        className="btn btn-ghost px-4 py-2 text-sm"
                                    >
                                        Mark Unread
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
